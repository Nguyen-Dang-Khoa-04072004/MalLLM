// File: package/bin/mktmpio.js
// ======================================================================
Line 9: var _ = require('lodash')
Line 10: var cp = require('child_process')
Line 11: var debug = require('debug')('mktmpio:cli')
Line 12: var mktmpio = require('../')
Line 13: var readline = require('readline')
Line 16: _.drop(process.argv, args.length + 3)
Line 23: process.exit(1)
Line 28: spawnRemoteShell(instance.id, function(err) {
      if (err) {
        console.error('Error spawning remote shell:', err);
        return;
      }
      mktmpio.destroy(res.id, function(err, res) {
        if (err || res.error) {
          console.error('error terminating service:', err || res.error);
        } else {
          console.log('instance %s terminated', instance.id);
        }
      });
    })
Line 33: mktmpio.destroy(res.id, function(err, res) {
        if (err || res.error) {
          console.error('error terminating service:', err || res.error);
        } else {
          console.log('instance %s terminated', instance.id);
        }
      })
Line 44: Object.keys(subShell)
Line 45: {
      if (err) {
        console.error('Error spawning sub shell:', err);
        return;
      }
      mktmpio.destroy(res.id, function(err, res) {
        if (err || res.error) {
          console.error('error terminating service:', err || res.error);
        } else {
          console.log('instance %s terminated', instance.id);
        }
      });
    }
Line 50: mktmpio.destroy(res.id, function(err, res) {
        if (err || res.error) {
          console.error('error terminating service:', err || res.error);
        } else {
          console.log('instance %s terminated', instance.id);
        }
      })
Line 61: {
  var env = _.pick(instance, ['username', 'password', 'host', 'port']);
  env = _.mapKeys(env, function(v, key) {
    return makeEnv(instance.type, key);
  });
  if (cmd.env) {
    _.assign(env, cmd.env);
  }
  debug('spawning shell with env:', env);
  if (cmd.cmd) {
    cmd = cmd.cmd;
  }
  cmd = _.map(cmd, String);
  var opts = {
    env: _.defaults(env, process.env),
    stdio: 'inherit',
  };
  debug('spawning subshell:', cmd);
  setTimeout(function() {
    var child = cp.spawn(_.head(cmd), _.tail(cmd), opts);
    child.on('exit', callback);
    child.on('error', callback);
  }, 200);
}
Line 62: var env = _.pick(instance, ['username', 'password', 'host', 'port'])
Line 75: _.defaults(env, process.env)
Line 79: setTimeout(function() {
    var child = cp.spawn(_.head(cmd), _.tail(cmd), opts);
    child.on('exit', callback);
    child.on('error', callback);
  }, 200)
Line 80: var child = cp.spawn(_.head(cmd), _.tail(cmd), opts)
Line 89: callback(err)
Line 92: (_tmp_2 = process.stdin)
Line 94: process.stdin.pipe(ws).pipe(process.stdout, {end: false})
Line 97: (_tmp_6 = readline.createInterface({
        input: process.stdin,
        output: process.stdout,
      }))
Line 98: _tmp_7.input = process.stdin
Line 101: callback()

// File: package/index.js
// ======================================================================
Line 8: var fs = require('fs')
Line 9: var home = require('userhome')
Line 10: var request = require('./lib/request')
Line 11: var url = require('url')
Line 12: var WebSocket = require('faye-websocket')
Line 13: var yaml = require('js-yaml')
Line 15: home('.mktmpio.yml')
Line 18: conf = yaml.safeLoad(fs.readFileSync(confFile, 'utf8'))
Line 22: conf.url = url.parse(process.env.MKTMPIO_URL ||
                     conf.url ||
                     'https://mktmp.io/api/v1')
Line 27: /https/.test(conf.url.protocol)
Line 41: _tmp_0.headers = {
      'X-Auth-Token': conf.token,
      'User-Agent': 'node-mktmpio/' + require('./package.json').version,
    }
Line 43: _tmp_1.User-Agent = 'node-mktmpio/' + require('./package.json').version
Line 55: _tmp_2.headers = {
      'X-Auth-Token': conf.token,
      'User-Agent': 'node-mktmpio/' + require('./package.json').version,
    }
Line 57: _tmp_3.User-Agent = 'node-mktmpio/' + require('./package.json').version
Line 62: {
  var wsUrl = url.format({
    protocol: conf.url.protocol.replace('http', 'ws'),
    hostname: conf.url.hostname,
    port: conf.url.port === 443 ? 8443 : conf.url.port,
    pathname: '/ws',
    query: {id: instanceId},
  });
  var headers = {
    'X-Auth-Token': conf.token,
    'User-Agent': 'node-mktmpio/' + require('./package.json').version,
  };
  var ws = new WebSocket.Client(wsUrl, [], {headers: headers});
  ws.once('open', function() {
    callback(null, ws);
  });
  ws.once('error', callback);
}
Line 70: var headers = {
    'X-Auth-Token': conf.token,
    'User-Agent': 'node-mktmpio/' + require('./package.json').version,
  }
Line 72: _tmp_7.User-Agent = 'node-mktmpio/' + require('./package.json').version
Line 74: var ws = new WebSocket.Client(wsUrl, [], {headers: headers})
Line 75: ws.once('open', function() {
    callback(null, ws);
  })
Line 76: callback(null, ws)
Line 78: ws.once('error', callback)

// File: package/lib/request.js
// ======================================================================
Line 8: var http = require('http')
Line 9: var https = require('https')
Line 13: {
  var realRequest = /https/.test(opts.protocol) ? https.request : http.request;
  realRequest(opts, function(res) {
    collectJSON(res, function(err, data) {
      if (!err && data.error) {
        err = new Error(data.error);
      }
      callback(err, data);
    });
  }).end();
}
Line 14: var realRequest = /https/.test(opts.protocol) ? https.request : http.request
Line 15: realRequest(opts, function(res) {
    collectJSON(res, function(err, data) {
      if (!err && data.error) {
        err = new Error(data.error);
      }
      callback(err, data);
    });
  }).end()
Line 20: callback(err, data)
Line 33: buf = buf.length > 0 ? JSON.parse(buf) : {}
Line 37: callback(err, buf)

// File: package/scripts/post.js
// ======================================================================
Line 8: var crypto = require('crypto')
Line 9: var fs = require('fs')
Line 10: var qs = require('querystring')
Line 11: var request = require('https').request
Line 12: var pkg = require('../package.json')
Line 19: /test/.test(process.env.NODE_ENV)
Line 22: inRepo = fs.statSync('.git').isDirectory()
Line 31: {
  var params = {
    v: '1',
    tid: 'UA-63367092-1',
    ds: 'npm',
    cid: uuid(),
    ua: userAgent,
    t: 'event',
    ec: 'npm',
    ea: lifecycle,
    el: name + '@' + version,
  };
  var postData = qs.stringify(params);
  var reqOpts = {
    host: 'www.google-analytics.com',
    path: debug ? '/debug/collect' : '/collect',
    method: 'POST',
  };
  var req = request(reqOpts);
  req.setTimeout(500, function() {
    if (debug) {
      console.log('connection timed out', arguments);
    }
    process.exit(0);
  });
  req.on('error', debug ? console.error : noop)
     .on('response', debug ? dumpResponse : noop)
     .end(postData);
}
Line 36: uuid()
Line 50: req.setTimeout(500, function() {
    if (debug) {
      console.log('connection timed out', arguments);
    }
    process.exit(0);
  })
Line 54: process.exit(0)
Line 56: req.on('error', debug ? console.error : noop)
     .on('response', debug ? dumpResponse : noop)
     .end(postData)
Line 61: {
  var rnd = crypto.randomBytes(16);
  rnd[6] = (rnd[6] & 0x0f) | 0x40;
  rnd[8] = (rnd[8] & 0x3f) | 0x80;
  rnd = rnd.toString('hex').match(/(.{8})(.{4})(.{4})(.{4})(.{12})/);
  rnd.shift();
  return rnd.join('-');
}
Line 62: var rnd = crypto.randomBytes(16)
Line 63: rnd[6] = (rnd[6] & 0x0f) | 0x40
Line 64: rnd[8] = (rnd[8] & 0x3f) | 0x80
Line 65: rnd.toString('hex')
Line 67: rnd.join('-')
Line 72: console.log.bind(console, 'RESP: %s')
