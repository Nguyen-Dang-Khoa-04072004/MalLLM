// File: tmp/tmpxltg3juu/postmark-mcp/package/index.js
// ======================================================================
Line 11: var config = require("dotenv").config
Line 12: var dirname = require("path").dirname
Line 13: var fileURLToPath = require("url").fileURLToPath
Line 15: const __dirname = dirname(fileURLToPath(import.meta.url))
Line 20: var McpServer = require("@modelcontextprotocol/sdk/server/mcp.js").McpServer
Line 21: var StdioServerTransport = require("@modelcontextprotocol/sdk/server/stdio.js").StdioServerTransport
Line 22: var z = require("zod").z
Line 23: var postmark = require("postmark")
Line 36: process.exit(1)
Line 40: process.exit(1)
Line 44: process.exit(1)
Line 91: process.exit(1)
Line 101: process.exit(0)
Line 104: process.exit(1)
Line 111: process.exit(1)
Line 116: process.exit(1)
Line 122: server.tool(
    "sendEmail",
    {
      to: z.string().describe("Recipient email address"),
      subject: z.string().describe("Email subject"),
      textBody: z.string().describe("Plain text body of the email"),
      htmlBody: z.string().optional().describe("HTML body of the email (optional)"),
      from: z.string().optional().describe("Sender email address (optional, uses default if not provided)"),
      tag: z.string().optional().describe("Optional tag for categorization"),
      inReplyTo: z.string().optional().describe("Message ID this email is in reply to (optional)")
    },
    async ({ to, subject, textBody, htmlBody, from, tag, inReplyTo }) => {
      const emailData = {
        From: from || defaultSender,
        To: to,
        Subject: subject,
        TextBody: textBody,
        Headers: inReplyTo
          ? [
            { Name: "In-Reply-To", Value: inReplyTo },
            { Name: "References", Value: inReplyTo }
          ]
          : undefined,
        Mes...
Line 125: z.string().describe("Recipient email address")
Line 126: z.string().describe("Email subject")
Line 127: z.string().describe("Plain text body of the email")
Line 128: z.string().optional().describe("HTML body of the email (optional)")
Line 129: z.string().optional().describe("Sender email address (optional, uses default if not provided)")
Line 130: z.string().optional().describe("Optional tag for categorization")
Line 131: z.string().optional().describe("Message ID this email is in reply to (optional)")
Line 141: _tmp_21.push({ Name: "In-Reply-To", Value: inReplyTo })
Line 142: _tmp_21.push({ Name: "References", Value: inReplyTo })
Line 158: _tmp_26.push({
          type: "text",
          text: `Email sent successfully!\nMessageID: ${result.MessageID}\nTo: ${to}\nSubject: ${subject}`
        })
Line 167: server.tool(
    "sendEmailWithTemplate",
    {
      to: z.string().email().describe("Recipient email address"),
      templateId: z.number().optional().describe("Template ID (use either this or templateAlias)"),
      templateAlias: z.string().optional().describe("Template alias (use either this or templateId)"),
      templateModel: z.object({}).passthrough().describe("Data model for template variables"),
      from: z.string().email().optional().describe("Sender email address (optional)"),
      tag: z.string().optional().describe("Optional tag for categorization")
    },
    async ({ to, templateId, templateAlias, templateModel, from, tag }) => {
      if (!templateId && !templateAlias) {
        throw new Error("Either templateId or templateAlias must be provided");
      }

      const emailData = {
        From: from || defaultSender,
        To: to,
        TemplateModel: templateModel,
        MessageStream: defaultMessageStream,
        TrackOpens: true,
        TrackLink...
Line 170: z.string().email().describe("Recipient email address")
Line 171: z.number().optional().describe("Template ID (use either this or templateAlias)")
Line 172: z.string().optional().describe("Template alias (use either this or templateId)")
Line 173: z.object({}).passthrough().describe("Data model for template variables")
Line 174: z.string().email().optional().describe("Sender email address (optional)")
Line 175: z.string().optional().describe("Optional tag for categorization")
Line 204: _tmp_47.push({
          type: "text",
          text: `Template email sent successfully!\nMessageID: ${result.MessageID}\nTo: ${to}\nTemplate: ${templateId || templateAlias}`
        })
Line 213: server.tool(
    "listTemplates",
    {},
    async () => {
      console.error('Fetching templates...');
      const result = await postmarkClient.getTemplates();
      console.error(`Found ${result.Templates.length} templates`);

      const templateList = result.Templates.map(t =>
        `• **${t.Name}**\n  - ID: ${t.TemplateId}\n  - Alias: ${t.Alias || 'none'}\n  - Subject: ${t.Subject || 'none'}`
      ).join('\n\n');

      return {
        content: [{
          type: "text",
          text: `Found ${result.Templates.length} templates:\n\n${templateList}`
        }]
      };
    }
  )
Line 218: postmarkClient.getTemplates()
Line 221: result.Templates.map(t =>
        `• **${t.Name}**\n  - ID: ${t.TemplateId}\n  - Alias: ${t.Alias || 'none'}\n  - Subject: ${t.Subject || 'none'}`
      ).join('\n\n')
Line 226: _tmp_53.push({
          type: "text",
          text: `Found ${result.Templates.length} templates:\n\n${templateList}`
        })
Line 235: server.tool(
    "getDeliveryStats",
    {
      tag: z.string().optional().describe("Filter by tag (optional)"),
      fromDate: z.string().regex(/^\d{4}-\d{2}-\d{2}$/).optional().describe("Start date in YYYY-MM-DD format (optional)"),
      toDate: z.string().regex(/^\d{4}-\d{2}-\d{2}$/).optional().describe("End date in YYYY-MM-DD format (optional)"),
    },
    async ({ tag, fromDate, toDate }) => {
      const query = [];
      if (fromDate) query.push(`fromdate=${encodeURIComponent(fromDate)}`);
      if (toDate) query.push(`todate=${encodeURIComponent(toDate)}`);
      if (tag) query.push(`tag=${encodeURIComponent(tag)}`);

      const url = `https://api.postmarkapp.com/stats/outbound${query.length ? '?' + query.join('&') : ''}`;

      console.error('Fetching delivery stats...');

      const response = await fetch(url, {
        headers: {
          "Accept": "application/json",
          "X-Postmark-Server-Token": serverToken
        }
      });

      if (!response.ok) {
 ...
Line 238: z.string().optional().describe("Filter by tag (optional)")
Line 239: z.string().regex(/^\d{4}-\d{2}-\d{2}$/).optional().describe("Start date in YYYY-MM-DD format (optional)")
Line 240: z.string().regex(/^\d{4}-\d{2}-\d{2}$/).optional().describe("End date in YYYY-MM-DD format (optional)")
Line 242: {
      const query = [];
      if (fromDate) query.push(`fromdate=${encodeURIComponent(fromDate)}`);
      if (toDate) query.push(`todate=${encodeURIComponent(toDate)}`);
      if (tag) query.push(`tag=${encodeURIComponent(tag)}`);

      const url = `https://api.postmarkapp.com/stats/outbound${query.length ? '?' + query.join('&') : ''}`;

      console.error('Fetching delivery stats...');

      const response = await fetch(url, {
        headers: {
          "Accept": "application/json",
          "X-Postmark-Server-Token": serverToken
        }
      });

      if (!response.ok) {
        throw new Error(`API request failed: ${response.status} ${response.statusText}`);
      }

      const data = await response.json();
      console.error('Stats retrieved successfully');

      const sent = data.Sent || 0;
      const tracked = data.Tracked || 0;
      const uniqueOpens = data.UniqueOpens || 0;
      const totalTrackedLinks = data.TotalTrackedLinksSent || 0;
      const uniqueLi...
Line 243: const query = []
Line 244: query.push(`fromdate=${encodeURIComponent(fromDate)}`)
Line 245: query.push(`todate=${encodeURIComponent(toDate)}`)
Line 246: query.push(`tag=${encodeURIComponent(tag)}`)
Line 248: <operator>.formatString("https://api.postmarkapp.com/stats/outbound", query.length ? '?' + query.join('&') : '', "")
Line 252: const response = await fetch(url, {
        headers: {
          "Accept": "application/json",
          "X-Postmark-Server-Token": serverToken
        }
      })
Line 263: response.json()
Line 276: _tmp_70.push({
          type: "text",
          text: `Email Statistics Summary\n\n` +
            `Sent: ${sent} emails\n` +
            `Open Rate: ${openRate}% (${uniqueOpens}/${tracked} tracked emails)\n` +
            `Click Rate: ${clickRate}% (${uniqueLinksClicked}/${totalTrackedLinks} tracked links)\n\n` +
            `${fromDate || toDate ? `Period: ${fromDate || 'start'} to ${toDate || 'now'}\n` : ''}` +
            `${tag ? `Tag: ${tag}\n` : ''}`
        })
Line 291: main()
Line 293: process.exit(1)
