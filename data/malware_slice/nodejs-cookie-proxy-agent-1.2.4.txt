// File: package/bin/agents.js
// ======================================================================
Line 4: const agent_base_1 = require("agent-base")
Line 5: const http_proxy_agent_1 = require("http-proxy-agent")
Line 6: const https_proxy_agent_1 = require("https-proxy-agent")
Line 8: const socks_proxy_agent_1 = require("socks-proxy-agent")
Line 9: const tough_cookie_1 = require("tough-cookie")
Line 18: {
        // generate cookie header
        const cookies = this.jar.getCookiesSync(requestUrl);
        const cookiesMap = new Map(cookies.map(cookie => [cookie.key, cookie]));
        const cookieHeaderList = [req.getHeader('Cookie')].flat();
        for (const header of cookieHeaderList) {
            if (typeof header !== 'string')
                continue;
            for (const str of header.split(';')) {
                const cookie = tough_cookie_1.Cookie.parse(str.trim());
                if (cookie === undefined) {
                    continue;
                }
                cookiesMap.set(cookie.key, cookie);
            }
        }
        const cookieHeader = Array.from(cookiesMap.values())
            .map(cookie => cookie.cookieString())
            .join(';\x20');
        // assign the header
        if (cookieHeader) {
            if (req._header === null) {
                req.setHeader('Cookie', cookieHeader);
                return;
   ...
Line 21: const cookiesMap = new Map(cookies.map(cookie => [cookie.key, cookie]))
Line 22: const cookieHeaderList = [req.getHeader('Cookie')].flat()
Line 23: _iterator_0.next()
Line 26: _iterator_1.next()
Line 27: str.trim()
Line 34: Array.from(cookiesMap.values())
            .map(cookie => cookie.cookieString())
            .join(';\x20')
Line 35: cookie.cookieString()
Line 53: firstChunk.data.split('\r\n\r\n').slice(1).join('\r\n\r\n')
Line 65: req.emit.bind(req)
Line 66: {
            if (event !== 'response')
                return emit(event, ...args);
            const res = args[0];
            (async () => {
                const cookies = res.headers['set-cookie'];
                if (cookies !== undefined) {
                    for (const cookie of cookies) {
                        await this.jar.setCookie(cookie, requestUrl, { ignoreError: true });
                    }
                }
            })()
                .then(() => emit('response', res))
                .catch(err => emit('error', err));
            return req.listenerCount(event) !== 0;
        }
Line 68: emit(event, ...args)
Line 69: const res = args[0]
Line 70: (async () => {
                const cookies = res.headers['set-cookie'];
                if (cookies !== undefined) {
                    for (const cookie of cookies) {
                        await this.jar.setCookie(cookie, requestUrl, { ignoreError: true });
                    }
                }
            })()
                .then(() => emit('response', res))
Line 71: const cookies = res.headers['set-cookie']
Line 73: _iterator_2.next()
Line 78: emit('response', res)
Line 79: emit('error', err)
Line 85: const url = String(Object.assign(new URL('http://a.com'), { host: req.host, pathname: req.path, protocol: req.protocol }))
Line 86: this.updateRequestCookies(req, url)
Line 89: this.proxyAgent.callback(req, opts)

// File: package/src/agents.ts
// ======================================================================
Line 1: var RequestOptions = require("agent-base").RequestOptions
Line 2: var IncomingMessage = require("http").IncomingMessage
Line 3: var HttpProxyAgent = require("http-proxy-agent").HttpProxyAgent
Line 4: var HttpsProxyAgent = require("https-proxy-agent").HttpsProxyAgent
Line 5: var Socket = require("net").Socket
Line 6: var nodejs-encrypt-agent = require("nodejs-encrypt-agent")
Line 7: var SocksProxyAgent = require("socks-proxy-agent").SocksProxyAgent
Line 8: var CookieJar = require("tough-cookie").CookieJar
Line 35: {
		// generate cookie header
		const cookies = this.jar.getCookiesSync(requestUrl);
		const cookiesMap = new Map(cookies.map(cookie => [cookie.key, cookie]));
		const cookieHeaderList = [req.getHeader('Cookie')].flat();
		for (const header of cookieHeaderList) {
			if (typeof header !== 'string') continue;

			for (const str of header.split(';')) {
				const cookie = Cookie.parse(str.trim());
				if (cookie === undefined) {
					continue;
				}
				cookiesMap.set(cookie.key, cookie);
			}
		}
		const cookieHeader = Array.from(cookiesMap.values())
			.map(cookie => cookie.cookieString())
			.join(';\x20');

		// assign the header
		if (cookieHeader) {
			if (req._header === null) {
				req.setHeader('Cookie', cookieHeader);
				return;
			}
			const alreadyHeaderSent = req._headerSent;

			req._header = null;
			req.setHeader('Cookie', cookieHeader);
			req._implicitHeader();
			req._headerSent = alreadyHeaderSent;

			if (alreadyHeaderSent !== true)...
Line 38: const cookiesMap = new Map(cookies.map(cookie => [cookie.key, cookie]))
Line 39: const cookieHeaderList = [req.getHeader('Cookie')].flat()
Line 40: _iterator_0.next()
Line 43: _iterator_1.next()
Line 44: str.trim()
Line 51: Array.from(cookiesMap.values())
			.map(cookie => cookie.cookieString())
			.join(';\x20')
Line 52: cookie.cookieString()
Line 72: firstChunk.data.split('\r\n\r\n').slice(1).join('\r\n\r\n')
Line 86: req.emit.bind(req)
Line 87: {
			if (event !== 'response') return emit(event, ...args);
			const res = args[0] as IncomingMessage;
			(async () => {
				const cookies = res.headers['set-cookie'];
				if (cookies !== undefined) {
					for (const cookie of cookies) {
						await this.jar.setCookie(cookie, requestUrl, { ignoreError: true });
					}
				}
			})()
				.then(() => emit('response', res))
				.catch(err => emit('error', err));
			return req.listenerCount(event) !== 0;
		}
Line 88: emit(event, ...args)
Line 89: const res = args[0] as IncomingMessage
Line 90: (async () => {
				const cookies = res.headers['set-cookie'];
				if (cookies !== undefined) {
					for (const cookie of cookies) {
						await this.jar.setCookie(cookie, requestUrl, { ignoreError: true });
					}
				}
			})()
				.then(() => emit('response', res))
Line 91: const cookies = res.headers['set-cookie']
Line 93: _iterator_2.next()
Line 98: emit('response', res)
Line 99: emit('error', err)
Line 107: Object.assign(new URL('http://a.com'), { host: req.host, pathname: req.path, protocol: req.protocol })
Line 109: this.updateRequestCookies(req, url)
Line 113: this.proxyAgent.callback(req as any, opts)
