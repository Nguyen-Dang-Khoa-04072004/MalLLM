// File: tmp/tmpsqj2eq3q/ve-bamreader/package/src/bamiterator.js
// ======================================================================
Line 8: const BAM = require("./bam").BAM
Line 11: const fs = require("fs")
Line 12: const inflateBGZF = require("ve-bgzf").inflate
Line 51: _iterator_0.next()
Line 54: process.nextTick(() => {
      this.on_start(this.env);
      return this._init_loop();
    })
Line 65: setImmediate(() => this._init_loop())
Line 89: process.send(msg)
Line 92: {
    let offset;
    const { nocache } = this;
    const read_size = Math.min(this.end - this.offset, this.pitch);
    if (read_size <= 0) { return true; }
    let chunk = new Buffer(read_size);
    fs.readSync(this.reader.fd, chunk, 0, read_size, this.offset);
    let [infbuf, i_offsets, d_offsets] = Array.from(inflateBGZF(chunk));
    const infbuf_len = infbuf.length;
    if (infbuf_len === 0) {
      this.pitch += this.pitch;
      return read_size === (this.end - this.offset); // if true, ended
    }

    if (!nocache) {
      for (let i = 0; i < d_offsets.length; i++) {
        offset = d_offsets[i];
        if (i_offsets[i+1]) {
          this.reader.infbufs.set(this.offset + offset, infbuf.slice(i_offsets[i], i_offsets[i+1]));
        }
      }
    }

    let i_offset = 0;
    let current_i_offset = i_offsets.shift();
    let current_d_offset = this.offset + d_offsets.shift();
    while (true) {
      var bambuf;
      if ((i_offset + 4) > infbuf_len) { break; }
      const ...
Line 98: fs.readSync(this.reader.fd, chunk, 0, read_size, this.offset)
Line 99: let [infbuf, i_offsets, d_offsets] = Array.from(inflateBGZF(chunk))
Line 107: {
        offset = d_offsets[i];
        if (i_offsets[i+1]) {
          this.reader.infbufs.set(this.offset + offset, infbuf.slice(i_offsets[i], i_offsets[i+1]));
        }
      }
Line 108: offset = d_offsets[i]
Line 109: {
          this.reader.infbufs.set(this.offset + offset, infbuf.slice(i_offsets[i], i_offsets[i+1]));
        }
Line 110: this.reader.infbufs.set(this.offset + offset, infbuf.slice(i_offsets[i], i_offsets[i+1]))
Line 125: infbuf.copy(bambuf, 0, i_offset, i_offset + bytesize)

// File: tmp/tmpsqj2eq3q/ve-bamreader/package/src/child.js
// ======================================================================
Line 6: const BAMLineReader = require(__dirname + "/bamreader.js")
Line 8: const context = {
  LINE_SIZE : 11,
  crypto : require("crypto")
}
Line 10: _tmp_1.crypto = require("crypto")
Line 13: {
  BAMLineReader.parseSendable(msg, context);

  const reader = BAMLineReader.createFromObject(msg.reader);
  if (!msg.env) { msg.env = msg.$ || {}; }
  const { env } = msg;
  for (let k of ["start", "end", "n"]) { env[k] = msg[k]; }
  Object.defineProperty(env, "exit", {
    get() {
      env._exit_will_be_called = true;
      return function() {
        env.ended = true;
        process.send(env);
        return process.exit();
      };
    }
  }
  );

  const itr = BAMIterator.create(reader, msg);

  return itr.on_end = function($){
    if (typeof msg.on_end === "function") { msg.on_end.call(itr, $); }
    if (!$._exit_will_be_called) { return $.exit(); }
  };
}
Line 16: BAMLineReader.createFromObject(msg.reader)
Line 19: for (let k of ["start", "end", "n"]) { env[k] = msg[k]; }
Line 23: {
        env.ended = true;
        process.send(env);
        return process.exit();
      }
Line 25: process.send(env)
Line 26: process.exit()
Line 35: msg.on_end.call(itr, $)
Line 36: $.exit()

// File: tmp/tmpsqj2eq3q/ve-bamreader/package/src/index.js
// ======================================================================
Line 1: const BAMLineReader = require("./bamreader")
Line 4: {
    let seqReads = [];
    BAMLineReader.create(providedPath)
      .on("bam", function(bam, dOffset, iOffset) {
        seqReads.push({
          name: bam.qname,
          seq: bam.seq,
          pos: bam.pos,
          cigar: bam.cigar,
          reversed: bam.reversed
        });
        // seqReads should be an array of objects [{name, seq, pos, cigar, reversed}, {name, seq, pos, cigar}, ...]
        return seqReads;
      })
      .on("end", function() {
        resolve(seqReads);
      });
  }
Line 5: let seqReads = []
Line 8: seqReads.push({
          name: bam.qname,
          seq: bam.seq,
          pos: bam.pos,
          cigar: bam.cigar,
          reversed: bam.reversed
        })
