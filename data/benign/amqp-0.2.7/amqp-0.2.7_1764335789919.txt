exports.Promise.prototype.timeout = function(timeout) {
  if (!timeout) {
    return this._timeoutDuration;
  }

  this._timeoutDuration = timeout;

  if (this.hasFired) return;
  this._clearTimeout();

  var self = this;
  this._timer = setTimeout(function() {
    self._timer = null;
    if (self.hasFired) {
      return;
    }

    self.emitError(new Error('timeout'));
  }, timeout);

  return this;
}