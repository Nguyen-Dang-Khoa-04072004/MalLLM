__awaiter(this, void 0, void 0, function* () {
            if (this._onNewDocumentScript != null) {
                // NOTE: For details, see send('Page.addScriptToEvaluateOnNewDocument') code
                yield this.getPageClient(page).send('Page.removeScriptToEvaluateOnNewDocument', {
                    identifier: this._onNewDocumentScript
                });
                this._onNewDocumentScript = null;
            }
            if (((_a = this._session) === null || _a === void 0 ? void 0 : _a.connection()) != null) {
                this._session.off('CDPSession.Disconnected', this._onSessionDisconnected);
                yield this._session.detach();
                this._session = null;
            }
        })
this._onNewDocumentScript != null
this.getPageClient(page).send('Page.removeScriptToEvaluateOnNewDocument', {
                    identifier: this._onNewDocumentScript
                })
this._startStopMutex = new async_mutex_1.Mutex()
this._dropCapturedFrames = false
__awaiter(this, void 0, void 0, function* () {
            const page = this._page;
            const session = this._session;
            if (page == null || ((_a = this.getPageClient(page)) === null || _a === void 0 ? void 0 : _a.connection()) == null || (session === null || session === void 0 ? void 0 : session.connection()) == null) {
                return;
            }
            for (const frame of page.frames()) {
                yield frame.evaluate(this._injector);
                yield frame.evaluate(`${this._injected}.activate()`);
            }
            yield session.send('HeadlessExperimental.enable');
            this.doRequestFrameCapture(page, session);
        })
const page = this._page
__awaiter(this, void 0, void 0, function* () {
            yield this._startStopMutex.runExclusive(() => __awaiter(this, void 0, void 0, function* () { return yield this._start(target, options); }));
        })
page == null || ((_a = this.getPageClient(page)) === null || _a === void 0 ? void 0 : _a.connection()) == null || (session === null || session === void 0 ? void 0 : session.connection()) == null
_iterator_0 = <operator>.iterator(page.frames())
__awaiter(this, void 0, void 0, function* () {
            options = Object.assign(Object.assign({}, PuppeteerCaptureBase.DEFAULT_START_OPTIONS), (options !== null ? options : {}));
            if (options.waitForFirstFrame == null) {
                throw new Error('options.waitForFirstFrame can not be null or undefined');
            }
            if (options.waitForFirstFrame == null) {
                throw new Error('options.waitForFirstFrame can not be null or undefined');
            }
            if (this._page == null) {
                throw new Error('Not attached to a page');
            }
            if (this._isCapturing) {
                throw new Error('Capture is in progress');
            }
            if (this._page.isClosed()) {
                throw new Error('Can not start capturing a closed page');
            }
            if (typeof target === 'string' || target instanceof String) {
                yield (0, promises_1.mkdir)((0, path_1.dirname)(target.toSt...
throw new Error('options.waitForFirstFrame can not be null or undefined');
__awaiter(this, void 0, void 0, function* () {
            const page = this._page;
            const session = this._session;
            if (page == null || ((_a = this.getPageClient(page)) === null || _a === void 0 ? void 0 : _a.connection()) == null || (session === null || session === void 0 ? void 0 : session.connection()) == null) {
                return;
            }
            for (const frame of page.frames()) {
                yield frame.evaluate(`${this._injected}.deactivate()`);
                yield frame.evaluate(this._ejector);
            }
            yield session.send('HeadlessExperimental.disable');
        })
const session = this._session
page == null || ((_a = this.getPageClient(page)) === null || _a === void 0 ? void 0 : _a.connection()) == null || (session === null || session === void 0 ? void 0 : session.connection()) == null
session.send('HeadlessExperimental.disable')
