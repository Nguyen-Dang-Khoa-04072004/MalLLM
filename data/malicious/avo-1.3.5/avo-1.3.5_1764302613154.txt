api
    .request('POST', '/c/v1/pull', {
      origin: api.apiOrigin,
      auth: true,
      data: {
        schemaId: json.schema.id,
        branchId: json.branch.id,
        sources: _.map(sources, source => {
          return {id: source.id, path: source.path};
        })
      }
    })
    .then(res => {
      cancelWait();
      let result = res.body;
      if (result.ok) {
        codegen(json, result);
      } else {
        report.error(
          `Branch ${result.branchName} was ${
            result.reason
          } ${dateFns.distanceInWords(
            new Date(result.closedAt),
            new Date()
          )} ago. Pick another branch.`
        );
        checkout(null, json).then(json => {
          pull(sourceFilter, json);
        });
      }
    })