Promise.resolve(callback({ current: options.$current }))
      .then(resolve)
      .then(function() {
        if (timeout) clearTimeout(timeout);
        if (backoffTimeout) clearTimeout(backoffTimeout);
      })
      .catch(function(err) {
        if (timeout) clearTimeout(timeout);
        if (backoffTimeout) clearTimeout(backoffTimeout);

        lastError = err;
        if (options.report) options.report((err && err.toString()) || err, options, err);

        // Should not retry if max has been reached
        var shouldRetry = options.$current! < options.max;
        if (!shouldRetry) return reject(err);
        shouldRetry = options.match.length === 0 || options.match.some(function (match) {
          return matches(match, err)
        });
        if (!shouldRetry) return reject(err);

        var retryDelay = options.backoffBase * Math.pow(options.backoffExponent, options.$current - 1);

        // Do some accounting
        options.$current++;
        if (options.report) o...
resolve
{
        if (timeout) clearTimeout(timeout);
        if (backoffTimeout) clearTimeout(backoffTimeout);

        lastError = err;
        if (options.report) options.report((err && err.toString()) || err, options, err);

        // Should not retry if max has been reached
        var shouldRetry = options.$current! < options.max;
        if (!shouldRetry) return reject(err);
        shouldRetry = options.match.length === 0 || options.match.some(function (match) {
          return matches(match, err)
        });
        if (!shouldRetry) return reject(err);

        var retryDelay = options.backoffBase * Math.pow(options.backoffExponent, options.$current - 1);

        // Do some accounting
        options.$current++;
        if (options.report) options.report(`Retrying ${options.name} (${options.$current})`, options);

        if (retryDelay) {
          // Use backoff function to ease retry rate
          if (options.report) options.report(`Delaying retry of ${options.name} by ${re...
options.report((err && err.toString()) || err, options, err)
var retryDelay = options.backoffBase * Math.pow(options.backoffExponent, options.$current - 1)
<operator>.formatString("Retrying ", options.name, " (", options.$current, ")")
<operator>.formatString("Delaying retry of ", options.name, " by ", retryDelay, "")
backoffTimeout = setTimeout(function() {
            retryAsPromised(callback, options)
              .then(resolve)
              .catch(reject);
          }, retryDelay)
retryDelay
