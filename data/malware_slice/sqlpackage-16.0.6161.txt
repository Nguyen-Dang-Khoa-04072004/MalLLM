// File: package/lib/install.js
// ======================================================================
Line 3: const unzipper = require('unzipper')
Line 4: const url = require('url')
Line 5: const HttpsProxyAgent = require('https-proxy-agent')
Line 6: const https = require('https')
Line 7: const version = require('../package.json').version
Line 8: const chalk = require('chalk')
Line 9: const path = require('path')
Line 10: const fs = require('fs')
Line 11: const rimraf = require('rimraf')
Line 12: const glob = require('glob')
Line 13: const execSync = require('child_process').execSync
Line 14: const ProgressBar = require('progress')
Line 15: const os = require('os')
Line 18: path.join(path.dirname(__filename), '..', 'bin')
Line 20: rimraf.sync(bin)
Line 27: os.platform()
Line 28: endpoint = 'https://download.microsoft.com/download/5/f/6/5f693b52-f844-46f0-90d2-4c7562d8d566/sqlpackage-win7-x64-en-16.0.6161.0.zip'
Line 29: os.platform()
Line 30: os.arch()
Line 31: os.arch()
Line 33: endpoint = 'https://download.microsoft.com/download/7/2/a/72a55da0-38fc-49e4-bfdb-87dadf3737be/sqlpackage-osx-x64-en-16.0.6161.0.zip'
Line 35: os.platform()
Line 36: endpoint = 'https://download.microsoft.com/download/f/0/9/f091c731-45be-48fa-ae84-bc28388e3ef8/sqlpackage-linux-x64-en-16.0.6161.0.zip'
Line 38: os.platform()
Line 43: const options = url.parse(endpoint)
Line 59: (_tmp_1 = https.get(options, response => {

        const bar = new ProgressBar('[:bar] Downloading SqlPackage', {
            total: Number(response.headers['content-length']),
            width: 18
        });

        if (response.statusCode === 200) {
            const installPath = getPath();
            response.on('data', data => bar.tick(data.length));
            const unzipStream = unzipper.Extract({ path: installPath })
                .on('close', () => {
                    if (os.platform() === 'linux' || os.platform() === 'darwin') {
                        fs.chmodSync(`${installPath}/sqlpackage.exe`, 0o755);                        
                    }
                });
            response.pipe(unzipStream);
        } else {
            console.error(chalk.red('Error downloading zip file from ' + endpoint));
            console.error(chalk.red('Expected: 200, Actual: ' + response.statusCode));
            process.exit(1);
        }
    }))
Line 61: new ProgressBar('[:bar] Downloading SqlPackage', {
            total: Number(response.headers['content-length']),
            width: 18
        })
Line 62: _tmp_3.total = Number(response.headers['content-length'])
Line 68: bar.tick(data.length)
Line 71: os.platform()
Line 72: <operator>.formatString("", installPath, "/sqlpackage.exe")
Line 75: response.pipe(unzipStream)
Line 79: process.exit(1)
Line 84: process.exit(1)

// File: package/lib/main.js
// ======================================================================
Line 3: const path = require('path')
Line 4: const fs = require('fs')
Line 5: const spawn = require('child_process').spawn
Line 6: const fork = require('child_process').fork
Line 7: const commandExists = require('command-exists')
Line 10: {
    const bin = path.resolve(path.join(path.dirname(__filename), '..', 'bin'));
    const sqlPackageProc = spawn(bin + '/sqlpackage.exe', args.slice(2), {
        stdio: [process.stdin, process.stdout, process.stderr, 'pipe']
    });

    funcProc.on('exit', code => {
        process.exit(code);
    });
}
Line 11: path.join(path.dirname(__filename), '..', 'bin')
Line 12: const sqlPackageProc = spawn(bin + '/sqlpackage.exe', args.slice(2), {
        stdio: [process.stdin, process.stdout, process.stderr, 'pipe']
    })
Line 13: _tmp_0.stdio = [process.stdin, process.stdout, process.stderr, 'pipe']
Line 17: process.exit(code)
Line 21: main()
