api
    .request('POST', '/auth/token', {
      origin: api.apiOrigin,
      data: {
        token: code,
        redirect_uri: callbackUrl
      }
    })
    .then(
      function(res) {
        if (!_.has(res, 'body.idToken') && !_.has(res, 'body.refreshToken')) {
          throw INVALID_CREDENTIAL_ERROR;
        }
        lastAccessToken = _.assign(
          {
            expiresAt: Date.now() + res.body.expiresIn * 1000
          },
          res.body
        );
        return lastAccessToken;
      },
      function(err) {
        throw INVALID_CREDENTIAL_ERROR;
      }
    )