Proxy.prototype = {
        request: function( params, callback, errCallback ) {
            // special code for hsf proxy
            if ( this._opt.type === 'hsf' || this._opt.type === 'mysql'  ) {
                params = { args: JSON.stringify(params) };
            }
            IO( {
                url: this._opt.bypass
                        ? this._opt.url 
                            + ( this._opt.url.indexOf( '?' ) === -1 ? '?' : '&' )
                            + '_version=' + this._opt.version
                        : Proxy.base + '/' + this._opt.id,
                data: params,
                type: this._opt.method,
                dataType: this._opt.bypass ? 'jsonp': this._opt.dataType,
                success: callback,
                error: errCallback
            } );
        },
        getOptions: function() {
            return this._opt;
        }
    }
this._opt.type === 'hsf' || this._opt.type === 'mysql'
var mtopCofig = {
    urls: {
        prod: 'http://api.m.taobao.com/rest/h5ApiUpdate.do',
        prep: 'http://api.wapa.taobao.com/rest/h5ApiUpdate.do',
        daily: 'http://api.waptest.taobao.com/rest/h5ApiUpdate.do'
    },
    tokenName: '_m_h5_tk',
    appKey: '12574478',
    appKeys: {
        prod: '12574478',
        prep: '12574478',
        daily: '4272'
    }
}
function HsfProxy = function HsfProxy( options ) {
    this._opt = options;
    // @See Readme.md about the hsf interface configuration
    var opt = {
        group: options.group || 'HSF',
        connectTimeout: options.connectTimeout || 3000 ,
        responseTimeout: options.responseTimeout || 3000,
        keepAlive: options.keepAlive,
        noDelay: options.noDelay
    };
    if ( this._opt.status === Constant.STATUS_MOCK 
        || this._opt.status === Constant.STATUS_MOCK_ERR ) {
        return;
    }

    client = client ? client : hsf.createClient( hsfOptions );

    this._consumer = client.createConsumer( options.service, options.version, opt );
}
app.get( '/getMycart', function( req, res ) {
    var cookie = req.headers.cookie;
    console.log( 'request cookie:\n', cookie );
    var cart = DataProxy.create( 'Cart.*' );
    cart.getMyCart()
        .withCookie( cookie )
        .done( function( data , setCookies ) {
            console.log( 'response cookie:\n', setCookies );
            res.setHeader( 'Set-Cookie', setCookies );
            res.send( data );
        }, function( err ) {
            console.log( err );
            res.send( 500, err );
        } );
} )
MtopProxy.super_.prototype.requestReal
            .call( this, params, function( result ) {
                if ( result.retType === 0 ) {
                    callback( result );
                } else {
                    var err = new Error( result.ret[0] 
                        + '\nresponseText: ' + JSON.stringify( result ) );
                    err.code = result.ret[0].split( '::' )[0];
                    errCallback( err );
                }
            }, errCallback, cookie )
