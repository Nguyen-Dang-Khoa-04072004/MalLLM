(_tmp_10 = progress(request(url, options), {
        delay: options.progressDelay
    })
        .on('response', function(response) {
            contentLength = Number(response.headers['content-length']);

            var status = response.statusCode;

            if (status < 200 || status >= 300) {
                return deferred.reject(
                    createError('Status code of ' + status, 'EHTTP')
                );
            }

            var writeStream = createWriteStream(file);
            var errored = false;

            // Change error listener so it cleans up writeStream before exiting
            req.removeListener('error', reject);
            req.on('error', function(error) {
                errored = true;
                destroy(req);
                destroy(writeStream);

                // Wait for writeStream to cleanup after itself...
                // TODO: Maybe there's a better way?
                setTimeout(function() {
                    deferred.reject(e...).on